(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8231],{1583:function(t){"use strict";var e=Object.defineProperty,i=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,r={};((t,i)=>{for(var n in i)e(t,n,{get:i[n],enumerable:!0})})(r,{Analytics:()=>l}),t.exports=((t,r,o,a)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let o of n(r))s.call(t,o)||void 0===o||e(t,o,{get:()=>r[o],enumerable:!(a=i(r,o))||a.enumerable});return t})(e({},"__esModule",{value:!0}),r);var o=class{constructor(t,e,i){this.prefix=t,this.table=e,this.bucket=i}toString(){return[this.prefix,this.table,this.bucket].join(":")}static fromString(t){let[e,i,n]=t.split(":");return new o(e,i,parseInt(n))}},a=class{cache;ttl;constructor(t){this.cache=new Map,this.ttl=t,setInterval(()=>{let t=Date.now();for(let[e,{createdAt:i}]of this.cache)t-i>this.ttl&&this.cache.delete(e)},10*this.ttl)}get(t){let e=this.cache.get(t);return e?Date.now()-e.createdAt>this.ttl?(this.cache.delete(t),null):e.value:null}set(t,e){this.cache.set(t,{createdAt:Date.now(),value:e})}},l=class{redis;prefix;bucketSize;retention;cache=new a(6e4);constructor(t){this.redis=t.redis,this.prefix=t.prefix??"@upstash/analytics",this.bucketSize=this.parseWindow(t.window),this.retention=t.retention?this.parseWindow(t.retention):void 0}validateTableName(t){if(!/^[a-zA-Z0-9_-]+$/.test(t))throw Error(`Invalid table name: ${t}. Table names can only contain letters, numbers, dashes and underscores.`)}parseWindow(t){if("number"==typeof t){if(t<=0)throw Error(`Invalid window: ${t}`);return t}let e=/^(\d+)([smhd])$/;if(!e.test(t))throw Error(`Invalid window: ${t}`);let[,i,n]=t.match(e),s=parseInt(i);switch(n){case"s":return 1e3*s;case"m":return 6e4*s;case"h":return 36e5*s;case"d":return 864e5*s;default:throw Error(`Invalid window unit: ${n}`)}}async ingest(t,...e){this.validateTableName(t),await Promise.all(e.map(async e=>{let i=Math.floor((e.time??Date.now())/this.bucketSize)*this.bucketSize,n=[this.prefix,t,i].join(":");await this.redis.hincrby(n,JSON.stringify({...e,time:void 0}),1)}))}async loadBuckets(t,e){this.validateTableName(t);let i=Date.now(),n=[];if(e.scan){let s=0,r=[this.prefix,t,"*"].join(":");do{let[t,o]=await this.redis.scan(s,{match:r});for(let r of(s=t,o)){let t=parseInt(r.split(":").pop());if(this.retention&&t<i-this.retention){await this.redis.del(r);continue}(t>=e.range[0]||t<=e.range[1])&&n.push(r)}}while(0!==s)}else{let s=Math.floor(i/this.bucketSize)*this.bucketSize;for(;s>e.range[1];)s-=this.bucketSize;for(;s>=e.range[0];)n.push([this.prefix,t,s].join(":")),s-=this.bucketSize}let s=[],r=[];for(let t of n){let e=this.cache.get(t);e?r.push({key:t,hash:e}):s.push(t)}let o=this.redis.pipeline();for(let t of s)o.hgetall(t);let a=s.length>0?await o.exec():[];for(let t=0;t<s.length;t++){let e=s[t],i=a[t];i&&this.cache.set(e,i),r.push({key:e,hash:i??{}})}return r.sort((t,e)=>t.hash.time-e.hash.time)}async count(t,e){this.validateTableName(t);let i=await this.loadBuckets(t,{range:e.range});return await Promise.all(i.map(async({key:t,hash:e})=>({time:parseInt(t.split(":").pop()),count:Object.values(e).reduce((t,e)=>t+e,0)})))}async aggregateBy(t,e,i){this.validateTableName(t);let n=await this.loadBuckets(t,{range:i.range});return await Promise.all(n.map(async({key:t,hash:i})=>{let n={time:o.fromString(t).bucket};for(let[t,s]of Object.entries(i)){let i=JSON.parse(t);for(let[t,r]of Object.entries(i)){let o=i[e];n[o]||(n[o]={}),t!==e&&(n[o][r]||(n[o][r]=0),n[o][r]+=s)}}return n}))}async query(t,e){this.validateTableName(t);let i=await this.loadBuckets(t,{range:e.range});return await Promise.all(i.map(async({key:t,hash:i})=>{let n={time:o.fromString(t).bucket};for(let[t,s]of Object.entries(i)){let i=JSON.parse(t),r=!1;if(e?.where){for(let[t,n]of Object.entries(e.where))if(!(t in i)||i[t]!==n){r=!0;break}}if(!r)for(let[t,r]of Object.entries(i))(!e?.filter||e.filter.includes(t))&&(n[t]||(n[t]={}),n[t][r]||(n[t][r]=0),n[t][r]+=s)}return n}))}}},95677:function(t,e,i){"use strict";var n=Object.defineProperty,s=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,o=Object.prototype.hasOwnProperty,a={};((t,e)=>{for(var i in e)n(t,i,{get:e[i],enumerable:!0})})(a,{Analytics:()=>c,MultiRegionRatelimit:()=>m,Ratelimit:()=>_}),t.exports=((t,e,i,a)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of r(e))o.call(t,i)||void 0===i||n(t,i,{get:()=>e[i],enumerable:!(a=s(e,i))||a.enumerable});return t})(n({},"__esModule",{value:!0}),a);var l=i(1583),c=class{analytics;table="events";constructor(t){this.analytics=new l.Analytics({redis:t.redis,window:"1h",prefix:t.prefix??"@upstash/ratelimit",retention:"90d"})}extractGeo(t){return void 0!==t.geo?t.geo:void 0!==t.cf?t.cf:{}}async record(t){await this.analytics.ingest(this.table,t)}async series(t,e){return await this.analytics.query(this.table,{filter:[t],range:[e,Date.now()]})}async getUsage(t=0){let e=await this.analytics.aggregateBy(this.table,"identifier",{range:[t,Date.now()]}),i={};for(let t of e)for(let[e,n]of Object.entries(t))"time"!==e&&(i[e]||(i[e]={success:0,blocked:0}),i[e].success+=n.true??0,i[e].blocked+=n.false??0);return i}},h=class{cache;constructor(t){this.cache=t}isBlocked(t){if(!this.cache.has(t))return{blocked:!1,reset:0};let e=this.cache.get(t);return e<Date.now()?(this.cache.delete(t),{blocked:!1,reset:0}):{blocked:!0,reset:e}}blockUntil(t,e){this.cache.set(t,e)}set(t,e){this.cache.set(t,e)}get(t){return this.cache.get(t)||null}incr(t){let e=this.cache.get(t)??0;return e+=1,this.cache.set(t,e),e}};function u(t){let e=t.match(/^(\d+)\s?(ms|s|m|h|d)$/);if(!e)throw Error(`Unable to parse window size: ${t}`);let i=parseInt(e[1]);switch(e[2]){case"ms":return i;case"s":return 1e3*i;case"m":return 6e4*i;case"h":return 36e5*i;case"d":return 864e5*i;default:throw Error(`Unable to parse window size: ${t}`)}}var p=class{limiter;ctx;prefix;timeout;analytics;constructor(t){this.ctx=t.ctx,this.limiter=t.limiter,this.timeout=t.timeout??5e3,this.prefix=t.prefix??"@upstash/ratelimit",this.analytics=t.analytics?new c({redis:Array.isArray(this.ctx.redis)?this.ctx.redis[0]:this.ctx.redis,prefix:this.prefix}):void 0,t.ephemeralCache instanceof Map?this.ctx.cache=new h(t.ephemeralCache):void 0===t.ephemeralCache&&(this.ctx.cache=new h(new Map))}limit=async(t,e)=>{let i=[this.prefix,t].join(":"),n=null;try{let s=[this.limiter(this.ctx,i)];this.timeout>0&&s.push(new Promise(t=>{n=setTimeout(()=>{t({success:!0,limit:0,remaining:0,reset:0,pending:Promise.resolve()})},this.timeout)}));let r=await Promise.race(s);if(this.analytics)try{let i=e?this.analytics.extractGeo(e):void 0,n=this.analytics.record({identifier:t,time:Date.now(),success:r.success,...i}).catch(t=>{console.warn("Failed to record analytics",t)});r.pending=Promise.all([r.pending,n])}catch(t){console.warn("Failed to record analytics",t)}return r}finally{n&&clearTimeout(n)}};blockUntilReady=async(t,e)=>{let i;if(e<=0)throw Error("timeout must be positive");let n=Date.now()+e;for(;!(i=await this.limit(t)).success;){if(0===i.reset)throw Error("This should not happen");let t=Math.min(i.reset,n)-Date.now();if(await new Promise(e=>setTimeout(e,t)),Date.now()>n)break}return i}};function d(){let t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=e.length;for(let n=0;n<16;n++)t+=e.charAt(Math.floor(Math.random()*i));return t}var m=class extends p{constructor(t){super({prefix:t.prefix,limiter:t.limiter,timeout:t.timeout,analytics:t.analytics,ctx:{redis:t.redis,cache:t.ephemeralCache?new h(t.ephemeralCache):void 0}})}static fixedWindow(t,e){let i=u(e),n=`
    local key     = KEYS[1]
    local id      = ARGV[1]
    local window  = ARGV[2]
    
    redis.call("SADD", key, id)
    local members = redis.call("SMEMBERS", key)
    if #members == 1 then
    -- The first time this key is set, the value will be 1.
    -- So we only need the expire command once
      redis.call("PEXPIRE", key, window)
    end
    
    return members
`;return async function(e,s){if(e.cache){let{blocked:i,reset:n}=e.cache.isBlocked(s);if(i)return{success:!1,limit:t,remaining:0,reset:n,pending:Promise.resolve()}}let r=d(),o=Math.floor(Date.now()/i),a=[s,o].join(":"),l=e.redis.map(t=>({redis:t,request:t.eval(n,[a],[r,i])})),c=t-(await Promise.any(l.map(t=>t.request))).length-1;async function h(){let e=await Promise.all(l.map(t=>t.request)),i=Array.from(new Set(e.flatMap(t=>t)).values());for(let e of l){let n=await e.request;n.length>=t||0===i.filter(t=>!n.includes(t)).length||await e.redis.sadd(a,...i)}}let u=c>0,p=(o+1)*i;return e.cache&&!u&&e.cache.blockUntil(s,p),{success:u,limit:t,remaining:c,reset:p,pending:h()}}}static slidingWindow(t,e){let i=u(e),n=`
      local currentKey  = KEYS[1]           -- identifier including prefixes
      local previousKey = KEYS[2]           -- key of the previous bucket
      local tokens      = tonumber(ARGV[1]) -- tokens per window
      local now         = ARGV[2]           -- current timestamp in milliseconds
      local window      = ARGV[3]           -- interval in milliseconds
      local requestId   = ARGV[4]           -- uuid for this request


      local currentMembers = redis.call("SMEMBERS", currentKey)
      local requestsInCurrentWindow = #currentMembers
      local previousMembers = redis.call("SMEMBERS", previousKey)
      local requestsInPreviousWindow = #previousMembers

      local percentageInCurrent = ( now % window) / window
      if requestsInPreviousWindow * ( 1 - percentageInCurrent ) + requestsInCurrentWindow >= tokens then
        return {currentMembers, previousMembers, false}
      end

      redis.call("SADD", currentKey, requestId)
      table.insert(currentMembers, requestId)
      if requestsInCurrentWindow == 0 then 
        -- The first time this key is set, the value will be 1.
        -- So we only need the expire command once
        redis.call("PEXPIRE", currentKey, window * 2 + 1000) -- Enough time to overlap with a new window + 1 second
      end
      return {currentMembers, previousMembers, true}
      `,s=u(e);return async function(e,r){let o=d(),a=Date.now(),l=Math.floor(a/i),c=[r,l].join(":"),h=[r,l-1].join(":"),u=e.redis.map(e=>({redis:e,request:e.eval(n,[c,h],[t,a,s,o])})),p=a%s/s,[m,_,f]=await Promise.any(u.map(t=>t.request)),y=t-(_.length*(1-p)+m.length);async function w(){let e=(await Promise.all(u.map(t=>t.request))).flatMap(([t])=>t);for(let i of u){let[n]=await i.request;if(n.length>=t)continue;let s=e.filter(t=>!n.includes(t));0!==s.length&&await i.redis.sadd(c,...s)}}let g=(l+1)*s;return e.cache&&!f&&e.cache.blockUntil(r,g),{success:!!f,limit:t,remaining:y,reset:g,pending:w()}}}},_=class extends p{constructor(t){super({prefix:t.prefix,limiter:t.limiter,timeout:t.timeout,analytics:t.analytics,ctx:{redis:t.redis},ephemeralCache:t.ephemeralCache})}static fixedWindow(t,e){let i=u(e),n=`
    local key     = KEYS[1]
    local window  = ARGV[1]
    
    local r = redis.call("INCR", key)
    if r == 1 then 
    -- The first time this key is set, the value will be 1.
    -- So we only need the expire command once
    redis.call("PEXPIRE", key, window)
    end
    
    return r
    `;return async function(e,s){let r=Math.floor(Date.now()/i),o=[s,r].join(":");if(e.cache){let{blocked:i,reset:n}=e.cache.isBlocked(s);if(i)return{success:!1,limit:t,remaining:0,reset:n,pending:Promise.resolve()}}let a=await e.redis.eval(n,[o],[i]),l=a<=t,c=(r+1)*i;return e.cache&&!l&&e.cache.blockUntil(s,c),{success:l,limit:t,remaining:Math.max(0,t-a),reset:c,pending:Promise.resolve()}}}static slidingWindow(t,e){let i=`
      local currentKey  = KEYS[1]           -- identifier including prefixes
      local previousKey = KEYS[2]           -- key of the previous bucket
      local tokens      = tonumber(ARGV[1]) -- tokens per window
      local now         = ARGV[2]           -- current timestamp in milliseconds
      local window      = ARGV[3]           -- interval in milliseconds

      local requestsInCurrentWindow = redis.call("GET", currentKey)
      if requestsInCurrentWindow == false then
        requestsInCurrentWindow = 0
      end

      local requestsInPreviousWindow = redis.call("GET", previousKey)
      if requestsInPreviousWindow == false then
        requestsInPreviousWindow = 0
      end
      local percentageInCurrent = ( now % window ) / window
      -- weighted requests to consider from the previous window
      requestsInPreviousWindow = math.floor(( 1 - percentageInCurrent ) * requestsInPreviousWindow)
      if requestsInPreviousWindow + requestsInCurrentWindow >= tokens then
        return -1
      end

      local newValue = redis.call("INCR", currentKey)
      if newValue == 1 then 
        -- The first time this key is set, the value will be 1.
        -- So we only need the expire command once
        redis.call("PEXPIRE", currentKey, window * 2 + 1000) -- Enough time to overlap with a new window + 1 second
      end
      return tokens - ( newValue + requestsInPreviousWindow )
      `,n=u(e);return async function(e,s){let r=Date.now(),o=Math.floor(r/n),a=[s,o].join(":"),l=[s,o-1].join(":");if(e.cache){let{blocked:i,reset:n}=e.cache.isBlocked(s);if(i)return{success:!1,limit:t,remaining:0,reset:n,pending:Promise.resolve()}}let c=await e.redis.eval(i,[a,l],[t,r,n]),h=c>=0,u=(o+1)*n;return e.cache&&!h&&e.cache.blockUntil(s,u),{success:h,limit:t,remaining:Math.max(0,c),reset:u,pending:Promise.resolve()}}}static tokenBucket(t,e,i){let n=`
        local key         = KEYS[1]           -- identifier including prefixes
        local maxTokens   = tonumber(ARGV[1]) -- maximum number of tokens
        local interval    = tonumber(ARGV[2]) -- size of the window in milliseconds
        local refillRate  = tonumber(ARGV[3]) -- how many tokens are refilled after each interval
        local now         = tonumber(ARGV[4]) -- current timestamp in milliseconds
        
        local bucket = redis.call("HMGET", key, "refilledAt", "tokens")
        
        local refilledAt
        local tokens

        if bucket[1] == false then
          refilledAt = now
          tokens = maxTokens
        else
          refilledAt = tonumber(bucket[1])
          tokens = tonumber(bucket[2])
        end
        
        if now >= refilledAt + interval then
          local numRefills = math.floor((now - refilledAt) / interval)
          tokens = math.min(maxTokens, tokens + numRefills * refillRate)

          refilledAt = refilledAt + numRefills * interval
        end

        if tokens == 0 then
          return {-1, refilledAt + interval}
        end

        local remaining = tokens - 1
        local expireAt = math.ceil(((maxTokens - remaining) / refillRate)) * interval
        
        redis.call("HSET", key, "refilledAt", refilledAt, "tokens", remaining)
        redis.call("PEXPIRE", key, expireAt)
        return {remaining, refilledAt + interval}
       `,s=u(e);return async function(e,r){if(e.cache){let{blocked:t,reset:n}=e.cache.isBlocked(r);if(t)return{success:!1,limit:i,remaining:0,reset:n,pending:Promise.resolve()}}let o=Date.now(),[a,l]=await e.redis.eval(n,[r],[i,s,t,o]),c=a>0;return e.cache&&!c&&e.cache.blockUntil(r,l),{success:c,limit:i,remaining:a,reset:l,pending:Promise.resolve()}}}static cachedFixedWindow(t,e){let i=u(e),n=`
      local key     = KEYS[1]
      local window  = ARGV[1]
      
      local r = redis.call("INCR", key)
      if r == 1 then 
      -- The first time this key is set, the value will be 1.
      -- So we only need the expire command once
      redis.call("PEXPIRE", key, window)
      end
      
      return r
      `;return async function(e,s){if(!e.cache)throw Error("This algorithm requires a cache");let r=Math.floor(Date.now()/i),o=[s,r].join(":"),a=(r+1)*i;if("number"==typeof e.cache.get(o)){let s=e.cache.incr(o),r=s<t,l=r?e.redis.eval(n,[o],[i]).then(t=>{e.cache.set(o,t)}):Promise.resolve();return{success:r,limit:t,remaining:t-s,reset:a,pending:l}}let l=await e.redis.eval(n,[o],[i]);e.cache.set(o,l);let c=t-l;return{success:c>=0,limit:t,remaining:c,reset:a,pending:Promise.resolve()}}}}},76782:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){return null!=t?t:e()}function r(t){let e;let i=t[0],n=1;for(;n<t.length;){let s=t[n],r=t[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==i)return;"access"===s||"optionalAccess"===s?(e=i,i=r(i)):("call"===s||"optionalCall"===s)&&(i=r((...t)=>i.call(e,...t)),e=void 0)}return i}Object.defineProperty(e,"__esModule",{value:!0});var o,a,l=class extends Error{constructor(t){super(t),this.name="UpstashError"}},c=class{constructor(t){this.options={backend:r([t,"access",t=>t.options,"optionalAccess",t=>t.backend]),agent:t.agent,responseEncoding:s(t.responseEncoding,()=>"base64"),cache:t.cache},this.baseUrl=t.baseUrl.replace(/\/$/,""),this.headers={"Content-Type":"application/json",...t.headers},"base64"===this.options.responseEncoding&&(this.headers["Upstash-Encoding"]="base64"),"boolean"==typeof r([t,"optionalAccess",t=>t.retry])&&!1===r([t,"optionalAccess",t=>t.retry])?this.retry={attempts:1,backoff:()=>0}:this.retry={attempts:s(r([t,"optionalAccess",t=>t.retry,"optionalAccess",t=>t.retries]),()=>5),backoff:s(r([t,"optionalAccess",t=>t.retry,"optionalAccess",t=>t.backoff]),()=>t=>50*Math.exp(t))}}mergeTelemetry(t){function e(t,e,i){return i&&(t[e]?t[e]=[t[e],i].join(","):t[e]=i),t}this.headers=e(this.headers,"Upstash-Telemetry-Runtime",t.runtime),this.headers=e(this.headers,"Upstash-Telemetry-Platform",t.platform),this.headers=e(this.headers,"Upstash-Telemetry-Sdk",t.sdk)}async request(t){let e={cache:this.options.cache,method:"POST",headers:this.headers,body:JSON.stringify(t.body),keepalive:!0,agent:r([this,"access",t=>t.options,"optionalAccess",t=>t.agent]),backend:r([this,"access",t=>t.options,"optionalAccess",t=>t.backend])},i=null,n=null;for(let r=0;r<=this.retry.attempts;r++)try{i=await fetch([this.baseUrl,...s(t.path,()=>[])].join("/"),e);break}catch(t){n=t,await new Promise(t=>setTimeout(t,this.retry.backoff(r)))}if(!i)throw s(n,()=>Error("Exhausted all retries"));let o=await i.json();if(!i.ok)throw new l(`${o.error}, command was: ${JSON.stringify(t.body)}`);return"base64"===r([this,"access",t=>t.options,"optionalAccess",t=>t.responseEncoding])?Array.isArray(o)?o.map(({result:t,error:e})=>({result:u(t),error:e})):{result:u(o.result),error:o.error}:o}};function h(t){let e="";try{let i=atob(t),n=i.length,s=new Uint8Array(n);for(let t=0;t<n;t++)s[t]=i.charCodeAt(t);e=new TextDecoder().decode(s)}catch(i){e=t}return e}function u(t){let e;switch(typeof t){case"undefined":return t;case"number":e=t;break;case"object":e=Array.isArray(t)?t.map(t=>"string"==typeof t?h(t):Array.isArray(t)?t.map(u):t):null;break;case"string":e="OK"===t?"OK":h(t)}return e}function p(t){try{return function t(e){let i=Array.isArray(e)?e.map(e=>{try{return t(e)}catch(t){return e}}):JSON.parse(e);return"number"==typeof i&&i.toString()!==e?e:i}(t)}catch(e){return t}}var d=t=>{switch(typeof t){case"string":case"number":case"boolean":return t;default:return JSON.stringify(t)}},m=class{constructor(t,e){this.serialize=d,this.deserialize=typeof r([e,"optionalAccess",t=>t.automaticDeserialization])>"u"||e.automaticDeserialization?s(r([e,"optionalAccess",t=>t.deserialize]),()=>p):t=>t,this.command=t.map(t=>this.serialize(t))}async exec(t){let{result:e,error:i}=await t.request({body:this.command});if(i)throw new l(i);if(typeof e>"u")throw Error("Request did not return a result");return this.deserialize(e)}},_=class extends m{constructor(t,e){super(["append",...t],e)}},f=class extends m{constructor([t,e,i],n){let s=["bitcount",t];"number"==typeof e&&s.push(e),"number"==typeof i&&s.push(i),super(s,n)}},y=class extends m{constructor(t,e){super(["bitop",...t],e)}},w=class extends m{constructor(t,e){super(["bitpos",...t],e)}},g=class extends m{constructor([t,e,i],n){super(["COPY",t,e,...r([i,"optionalAccess",t=>t.replace])?["REPLACE"]:[]],{...n,deserialize:t=>t>0?"COPIED":"NOT_COPIED"})}},b=class extends m{constructor(t){super(["dbsize"],t)}},v=class extends m{constructor(t,e){super(["decr",...t],e)}},x=class extends m{constructor(t,e){super(["decrby",...t],e)}},O=class extends m{constructor(t,e){super(["del",...t],e)}},k=class extends m{constructor(t,e){super(["echo",...t],e)}},E=class extends m{constructor([t,e,i],n){super(["eval",t,e.length,...e,...s(i,()=>[])],n)}},A=class extends m{constructor([t,e,i],n){super(["evalsha",t,e.length,...e,...s(i,()=>[])],n)}},S=class extends m{constructor(t,e){super(["exists",...t],e)}},P=class extends m{constructor(t,e){super(["expire",...t],e)}},T=class extends m{constructor(t,e){super(["expireat",...t],e)}},R=class extends m{constructor(t,e){let i=["flushall"];t&&t.length>0&&t[0].async&&i.push("async"),super(i,e)}},C=class extends m{constructor([t],e){let i=["flushdb"];r([t,"optionalAccess",t=>t.async])&&i.push("async"),super(i,e)}},I=class extends m{constructor([t,e,...i],n){let s=["geoadd",t];"nx"in e&&e.nx?s.push("nx"):"xx"in e&&e.xx&&s.push("xx"),"ch"in e&&e.ch&&s.push("ch"),"latitude"in e&&e.latitude&&s.push(e.longitude,e.latitude,e.member),s.push(...i.flatMap(({latitude:t,longitude:e,member:i})=>[e,t,i])),super(s,n)}},K=class extends m{constructor([t,e,i,n="M"],s){super(["GEODIST",t,e,i,n],s)}},j=class extends m{constructor(t,e){let[i]=t;super(["GEOPOS",i,...Array.isArray(t[1])?t[1]:t.slice(1)],{deserialize:t=>(function(t){let e=[];for(let i of t)r([i,"optionalAccess",t=>t[0]])&&r([i,"optionalAccess",t=>t[1]])&&e.push({lng:parseFloat(i[0]),lat:parseFloat(i[1])});return e})(t),...e})}},D=class extends m{constructor(t,e){let[i]=t;super(["GEOHASH",i,...Array.isArray(t[1])?t[1]:t.slice(1)],e)}},B=class extends m{constructor([t,e,i,n,s],o){let a=["GEOSEARCH",t];("FROMMEMBER"===e.type||"frommember"===e.type)&&a.push(e.type,e.member),("FROMLONLAT"===e.type||"fromlonlat"===e.type)&&a.push(e.type,e.coordinate.lon,e.coordinate.lat),("BYRADIUS"===i.type||"byradius"===i.type)&&a.push(i.type,i.radius,i.radiusType),("BYBOX"===i.type||"bybox"===i.type)&&a.push(i.type,i.rect.width,i.rect.height,i.rectType),a.push(n),r([s,"optionalAccess",t=>t.count])&&a.push(s.count.limit,...s.count.any?["ANY"]:[]),super([...a,...r([s,"optionalAccess",t=>t.withCoord])?["WITHCOORD"]:[],...r([s,"optionalAccess",t=>t.withDist])?["WITHDIST"]:[],...r([s,"optionalAccess",t=>t.withHash])?["WITHHASH"]:[]],{...o,deserialize:t=>r([s,"optionalAccess",t=>t.withCoord])||r([s,"optionalAccess",t=>t.withDist])||r([s,"optionalAccess",t=>t.withHash])?t.map(t=>{let e=1,i={};try{i.member=JSON.parse(t[0])}catch(e){i.member=t[0]}return s.withDist&&(i.dist=parseFloat(t[e++])),s.withHash&&(i.hash=t[e++].toString()),s.withCoord&&(i.coord={long:parseFloat(t[e][0]),lat:parseFloat(t[e][1])}),i}):t.map(t=>{try{return{member:JSON.parse(t)}}catch(e){return{member:t}}})})}},N=class extends m{constructor([t,e,i,n,s,o],a){let l=["GEOSEARCHSTORE",t,e];("FROMMEMBER"===i.type||"frommember"===i.type)&&l.push(i.type,i.member),("FROMLONLAT"===i.type||"fromlonlat"===i.type)&&l.push(i.type,i.coordinate.lon,i.coordinate.lat),("BYRADIUS"===n.type||"byradius"===n.type)&&l.push(n.type,n.radius,n.radiusType),("BYBOX"===n.type||"bybox"===n.type)&&l.push(n.type,n.rect.width,n.rect.height,n.rectType),l.push(s),r([o,"optionalAccess",t=>t.count])&&l.push(o.count.limit,...o.count.any?["ANY"]:[]),super([...l,...r([o,"optionalAccess",t=>t.storeDist])?["STOREDIST"]:[]],a)}},M=class extends m{constructor(t,e){super(["get",...t],e)}},z=class extends m{constructor(t,e){super(["getbit",...t],e)}},q=class extends m{constructor(t,e){super(["getdel",...t],e)}},F=class extends m{constructor(t,e){super(["getrange",...t],e)}},U=class extends m{constructor(t,e){super(["getset",...t],e)}},$=class extends m{constructor(t,e){super(["hdel",...t],e)}},W=class extends m{constructor(t,e){super(["hexists",...t],e)}},L=class extends m{constructor(t,e){super(["hget",...t],e)}},H=class extends m{constructor(t,e){super(["hgetall",...t],{deserialize:t=>(function(t){if(0===t.length)return null;let e={};for(;t.length>=2;){let i=t.shift(),n=t.shift();try{Number.isNaN(Number(n))||Number.isSafeInteger(n)?e[i]=JSON.parse(n):e[i]=n}catch(t){e[i]=n}}return e})(t),...e})}},V=class extends m{constructor(t,e){super(["hincrby",...t],e)}},G=class extends m{constructor(t,e){super(["hincrbyfloat",...t],e)}},J=class extends m{constructor([t],e){super(["hkeys",t],e)}},Y=class extends m{constructor(t,e){super(["hlen",...t],e)}},X=class extends m{constructor([t,...e],i){super(["hmget",t,...e],{deserialize:t=>(function(t,e){if(0===e.length||e.every(t=>null===t))return null;let i={};for(let n=0;n<t.length;n++)try{i[t[n]]=JSON.parse(e[n])}catch(s){i[t[n]]=e[n]}return i})(e,t),...i})}},Q=class extends m{constructor([t,e],i){super(["hmset",t,...Object.entries(e).flatMap(([t,e])=>[t,e])],i)}},Z=class extends m{constructor(t,e){let i=["hrandfield",t[0]];"number"==typeof t[1]&&i.push(t[1]),t[2]&&i.push("WITHVALUES"),super(i,{deserialize:t[2]?t=>(function(t){if(0===t.length)return null;let e={};for(;t.length>=2;){let i=t.shift(),n=t.shift();try{e[i]=JSON.parse(n)}catch(t){e[i]=n}}return e})(t):r([e,"optionalAccess",t=>t.deserialize]),...e})}},tt=class extends m{constructor([t,e,i],n){let s=["hscan",t,e];r([i,"optionalAccess",t=>t.match])&&s.push("match",i.match),"number"==typeof r([i,"optionalAccess",t=>t.count])&&s.push("count",i.count),super(s,n)}},te=class extends m{constructor([t,e],i){super(["hset",t,...Object.entries(e).flatMap(([t,e])=>[t,e])],i)}},ti=class extends m{constructor(t,e){super(["hsetnx",...t],e)}},tn=class extends m{constructor(t,e){super(["hstrlen",...t],e)}},ts=class extends m{constructor(t,e){super(["hvals",...t],e)}},tr=class extends m{constructor(t,e){super(["incr",...t],e)}},to=class extends m{constructor(t,e){super(["incrby",...t],e)}},ta=class extends m{constructor(t,e){super(["incrbyfloat",...t],e)}},tl=class extends m{constructor(t,e){super(["JSON.ARRAPPEND",...t],e)}},tc=class extends m{constructor(t,e){super(["JSON.ARRINDEX",...t],e)}},th=class extends m{constructor(t,e){super(["JSON.ARRINSERT",...t],e)}},tu=class extends m{constructor(t,e){super(["JSON.ARRLEN",t[0],s(t[1],()=>"$")],e)}},tp=class extends m{constructor(t,e){super(["JSON.ARRPOP",...t],e)}},td=class extends m{constructor(t,e){super(["JSON.ARRTRIM",t[0],s(t[1],()=>"$"),s(t[2],()=>0),s(t[3],()=>0)],e)}},tm=class extends m{constructor(t,e){super(["JSON.CLEAR",...t],e)}},t_=class extends m{constructor(t,e){super(["JSON.DEL",...t],e)}},tf=class extends m{constructor(t,e){super(["JSON.FORGET",...t],e)}},ty=class extends m{constructor(t,e){let i=["JSON.GET"];"string"==typeof t[1]?i.push(...t):(i.push(t[0]),t[1]&&(t[1].indent&&i.push("INDENT",t[1].indent),t[1].newline&&i.push("NEWLINE",t[1].newline),t[1].space&&i.push("SPACE",t[1].space)),i.push(...t.slice(2))),super(i,e)}},tw=class extends m{constructor(t,e){super(["JSON.MGET",...t[0],t[1]],e)}},tg=class extends m{constructor(t,e){super(["JSON.NUMINCRBY",...t],e)}},tb=class extends m{constructor(t,e){super(["JSON.NUMMULTBY",...t],e)}},tv=class extends m{constructor(t,e){super(["JSON.OBJKEYS",...t],e)}},tx=class extends m{constructor(t,e){super(["JSON.OBJLEN",...t],e)}},tO=class extends m{constructor(t,e){super(["JSON.RESP",...t],e)}},tk=class extends m{constructor(t,e){let i=["JSON.SET",t[0],t[1],t[2]];t[3]&&(t[3].nx?i.push("NX"):t[3].xx&&i.push("XX")),super(i,e)}},tE=class extends m{constructor(t,e){super(["JSON.STRAPPEND",...t],e)}},tA=class extends m{constructor(t,e){super(["JSON.STRLEN",...t],e)}},tS=class extends m{constructor(t,e){super(["JSON.TOGGLE",...t],e)}},tP=class extends m{constructor(t,e){super(["JSON.TYPE",...t],e)}},tT=class extends m{constructor(t,e){super(["keys",...t],e)}},tR=class extends m{constructor(t,e){super(["lindex",...t],e)}},tC=class extends m{constructor(t,e){super(["linsert",...t],e)}},tI=class extends m{constructor(t,e){super(["llen",...t],e)}},tK=class extends m{constructor(t,e){super(["lmove",...t],e)}},tj=class extends m{constructor(t,e){super(["lpop",...t],e)}},tD=class extends m{constructor(t,e){let i=["lpos",t[0],t[1]];"number"==typeof r([t,"access",t=>t[2],"optionalAccess",t=>t.rank])&&i.push("rank",t[2].rank),"number"==typeof r([t,"access",t=>t[2],"optionalAccess",t=>t.count])&&i.push("count",t[2].count),"number"==typeof r([t,"access",t=>t[2],"optionalAccess",t=>t.maxLen])&&i.push("maxLen",t[2].maxLen),super(i,e)}},tB=class extends m{constructor(t,e){super(["lpush",...t],e)}},tN=class extends m{constructor(t,e){super(["lpushx",...t],e)}},tM=class extends m{constructor(t,e){super(["lrange",...t],e)}},tz=class extends m{constructor(t,e){super(["lrem",...t],e)}},tq=class extends m{constructor(t,e){super(["lset",...t],e)}},tF=class extends m{constructor(t,e){super(["ltrim",...t],e)}},tU=class extends m{constructor(t,e){super(["mget",...Array.isArray(t[0])?t[0]:t],e)}},t$=class extends m{constructor([t],e){super(["mset",...Object.entries(t).flatMap(([t,e])=>[t,e])],e)}},tW=class extends m{constructor([t],e){super(["msetnx",...Object.entries(t).flatMap(t=>t)],e)}},tL=class extends m{constructor(t,e){super(["persist",...t],e)}},tH=class extends m{constructor(t,e){super(["pexpire",...t],e)}},tV=class extends m{constructor(t,e){super(["pexpireat",...t],e)}},tG=class extends m{constructor(t,e){super(["pfadd",...t],e)}},tJ=class extends m{constructor(t,e){super(["pfcount",...t],e)}},tY=class extends m{constructor(t,e){super(["pfmerge",...t],e)}},tX=class extends m{constructor(t,e){let i=["ping"];"u">typeof t&&"u">typeof t[0]&&i.push(t[0]),super(i,e)}},tQ=class extends m{constructor(t,e){super(["psetex",...t],e)}},tZ=class extends m{constructor(t,e){super(["pttl",...t],e)}},t1=class extends m{constructor(t,e){super(["publish",...t],e)}},t0=class extends m{constructor(t){super(["randomkey"],t)}},t2=class extends m{constructor(t,e){super(["rename",...t],e)}},t4=class extends m{constructor(t,e){super(["renamenx",...t],e)}},t3=class extends m{constructor(t,e){super(["rpop",...t],e)}},t5=class extends m{constructor(t,e){super(["rpush",...t],e)}},t8=class extends m{constructor(t,e){super(["rpushx",...t],e)}},t6=class extends m{constructor(t,e){super(["sadd",...t],e)}},t9=class extends m{constructor([t,e],i){let n=["scan",t];r([e,"optionalAccess",t=>t.match])&&n.push("match",e.match),"number"==typeof r([e,"optionalAccess",t=>t.count])&&n.push("count",e.count),r([e,"optionalAccess",t=>t.type])&&e.type.length>0&&n.push("type",e.type),super(n,i)}},t7=class extends m{constructor(t,e){super(["scard",...t],e)}},et=class extends m{constructor(t,e){super(["script","exists",...t],{deserialize:t=>t,...e})}},ee=class extends m{constructor([t],e){let i=["script","flush"];r([t,"optionalAccess",t=>t.sync])?i.push("sync"):r([t,"optionalAccess",t=>t.async])&&i.push("async"),super(i,e)}},ei=class extends m{constructor(t,e){super(["script","load",...t],e)}},en=class extends m{constructor(t,e){super(["sdiff",...t],e)}},es=class extends m{constructor(t,e){super(["sdiffstore",...t],e)}},er=class extends m{constructor([t,e,i],n){let s=["set",t,e];i&&("nx"in i&&i.nx?s.push("nx"):"xx"in i&&i.xx&&s.push("xx"),"get"in i&&i.get&&s.push("get"),"ex"in i&&"number"==typeof i.ex?s.push("ex",i.ex):"px"in i&&"number"==typeof i.px?s.push("px",i.px):"exat"in i&&"number"==typeof i.exat?s.push("exat",i.exat):"pxat"in i&&"number"==typeof i.pxat?s.push("pxat",i.pxat):"keepTtl"in i&&i.keepTtl&&s.push("keepTtl")),super(s,n)}},eo=class extends m{constructor(t,e){super(["setbit",...t],e)}},ea=class extends m{constructor(t,e){super(["setex",...t],e)}},el=class extends m{constructor(t,e){super(["setnx",...t],e)}},ec=class extends m{constructor(t,e){super(["setrange",...t],e)}},eh=class extends m{constructor(t,e){super(["sinter",...t],e)}},eu=class extends m{constructor(t,e){super(["sinterstore",...t],e)}},ep=class extends m{constructor(t,e){super(["sismember",...t],e)}},ed=class extends m{constructor(t,e){super(["smembers",...t],e)}},em=class extends m{constructor(t,e){super(["smismember",t[0],...t[1]],e)}},e_=class extends m{constructor(t,e){super(["smove",...t],e)}},ef=class extends m{constructor([t,e],i){let n=["spop",t];"number"==typeof e&&n.push(e),super(n,i)}},ey=class extends m{constructor([t,e],i){let n=["srandmember",t];"number"==typeof e&&n.push(e),super(n,i)}},ew=class extends m{constructor(t,e){super(["srem",...t],e)}},eg=class extends m{constructor([t,e,i],n){let s=["sscan",t,e];r([i,"optionalAccess",t=>t.match])&&s.push("match",i.match),"number"==typeof r([i,"optionalAccess",t=>t.count])&&s.push("count",i.count),super(s,n)}},eb=class extends m{constructor(t,e){super(["strlen",...t],e)}},ev=class extends m{constructor(t,e){super(["sunion",...t],e)}},ex=class extends m{constructor(t,e){super(["sunionstore",...t],e)}},eO=class extends m{constructor(t){super(["time"],t)}},ek=class extends m{constructor(t,e){super(["touch",...t],e)}},eE=class extends m{constructor(t,e){super(["ttl",...t],e)}},eA=class extends m{constructor(t,e){super(["type",...t],e)}},eS=class extends m{constructor(t,e){super(["unlink",...t],e)}},eP=class extends m{constructor([t,e,i,n],s){let r=["XADD",t];for(let[t,s]of(n&&(n.nomkStream&&r.push("NOMKSTREAM"),n.trim&&(r.push(n.trim.type,n.trim.comparison,n.trim.threshold),"u">typeof n.trim.limit&&r.push("LIMIT",n.trim.limit))),r.push(e),Object.entries(i)))r.push(t,s);super(r,s)}},eT=class extends m{constructor([t,e,i,n],s){let r=["XRANGE",t,e,i];"number"==typeof n&&r.push("COUNT",n),super(r,{deserialize:t=>(function(t){let e={};for(let i of t)for(;i.length>=2;){let t=i.shift(),n=i.shift();for((t in e)||(e[t]={});n.length>=2;){let i=n.shift(),s=n.shift();try{e[t][i]=JSON.parse(s)}catch(n){e[t][i]=s}}}return e})(t),...s})}},eR=class extends m{constructor([t,e,...i],n){let s=["zadd",t];"nx"in e&&e.nx?s.push("nx"):"xx"in e&&e.xx&&s.push("xx"),"ch"in e&&e.ch&&s.push("ch"),"incr"in e&&e.incr&&s.push("incr"),"score"in e&&"member"in e&&s.push(e.score,e.member),s.push(...i.flatMap(({score:t,member:e})=>[t,e])),super(s,n)}},eC=class extends m{constructor(t,e){super(["zcard",...t],e)}},eI=class extends m{constructor(t,e){super(["zcount",...t],e)}},eK=class extends m{constructor(t,e){super(["zincrby",...t],e)}},ej=class extends m{constructor([t,e,i,n],s){let r=["zinterstore",t,e];Array.isArray(i)?r.push(...i):r.push(i),n&&("weights"in n&&n.weights?r.push("weights",...n.weights):"weight"in n&&"number"==typeof n.weight&&r.push("weights",n.weight),"aggregate"in n&&r.push("aggregate",n.aggregate)),super(r,s)}},eD=class extends m{constructor(t,e){super(["zlexcount",...t],e)}},eB=class extends m{constructor([t,e],i){let n=["zpopmax",t];"number"==typeof e&&n.push(e),super(n,i)}},eN=class extends m{constructor([t,e],i){let n=["zpopmin",t];"number"==typeof e&&n.push(e),super(n,i)}},eM=class extends m{constructor([t,e,i,n],s){let o=["zrange",t,e,i];r([n,"optionalAccess",t=>t.byScore])&&o.push("byscore"),r([n,"optionalAccess",t=>t.byLex])&&o.push("bylex"),r([n,"optionalAccess",t=>t.rev])&&o.push("rev"),"u">typeof r([n,"optionalAccess",t=>t.count])&&"u">typeof r([n,"optionalAccess",t=>t.offset])&&o.push("limit",n.offset,n.count),r([n,"optionalAccess",t=>t.withScores])&&o.push("withscores"),super(o,s)}},ez=class extends m{constructor(t,e){super(["zrank",...t],e)}},eq=class extends m{constructor(t,e){super(["zrem",...t],e)}},eF=class extends m{constructor(t,e){super(["zremrangebylex",...t],e)}},eU=class extends m{constructor(t,e){super(["zremrangebyrank",...t],e)}},e$=class extends m{constructor(t,e){super(["zremrangebyscore",...t],e)}},eW=class extends m{constructor(t,e){super(["zrevrank",...t],e)}},eL=class extends m{constructor([t,e,i],n){let s=["zscan",t,e];r([i,"optionalAccess",t=>t.match])&&s.push("match",i.match),"number"==typeof r([i,"optionalAccess",t=>t.count])&&s.push("count",i.count),super(s,n)}},eH=class extends m{constructor(t,e){super(["zscore",...t],e)}},eV=class extends m{constructor([t,e,i],n){let s=["zunion",t];Array.isArray(e)?s.push(...e):s.push(e),i&&("weights"in i&&i.weights?s.push("weights",...i.weights):"weight"in i&&"number"==typeof i.weight&&s.push("weights",i.weight),"aggregate"in i&&s.push("aggregate",i.aggregate),r([i,"optionalAccess",t=>t.withScores])&&s.push("withscores")),super(s,n)}},eG=class extends m{constructor([t,e,i,n],s){let r=["zunionstore",t,e];Array.isArray(i)?r.push(...i):r.push(i),n&&("weights"in n&&n.weights?r.push("weights",...n.weights):"weight"in n&&"number"==typeof n.weight&&r.push("weights",n.weight),"aggregate"in n&&r.push("aggregate",n.aggregate)),super(r,s)}},eJ=class extends m{constructor(t,e){super(["zdiffstore",...t],e)}},eY=class extends m{constructor(t,e){let[i,n]=t;super(["zmscore",i,...n],e)}},eX=o=class{constructor(t){o.prototype.__init.call(this),o.prototype.__init2.call(this),o.prototype.__init3.call(this),o.prototype.__init4.call(this),o.prototype.__init5.call(this),o.prototype.__init6.call(this),o.prototype.__init7.call(this),o.prototype.__init8.call(this),o.prototype.__init9.call(this),o.prototype.__init10.call(this),o.prototype.__init11.call(this),o.prototype.__init12.call(this),o.prototype.__init13.call(this),o.prototype.__init14.call(this),o.prototype.__init15.call(this),o.prototype.__init16.call(this),o.prototype.__init17.call(this),o.prototype.__init18.call(this),o.prototype.__init19.call(this),o.prototype.__init20.call(this),o.prototype.__init21.call(this),o.prototype.__init22.call(this),o.prototype.__init23.call(this),o.prototype.__init24.call(this),o.prototype.__init25.call(this),o.prototype.__init26.call(this),o.prototype.__init27.call(this),o.prototype.__init28.call(this),o.prototype.__init29.call(this),o.prototype.__init30.call(this),o.prototype.__init31.call(this),o.prototype.__init32.call(this),o.prototype.__init33.call(this),o.prototype.__init34.call(this),o.prototype.__init35.call(this),o.prototype.__init36.call(this),o.prototype.__init37.call(this),o.prototype.__init38.call(this),o.prototype.__init39.call(this),o.prototype.__init40.call(this),o.prototype.__init41.call(this),o.prototype.__init42.call(this),o.prototype.__init43.call(this),o.prototype.__init44.call(this),o.prototype.__init45.call(this),o.prototype.__init46.call(this),o.prototype.__init47.call(this),o.prototype.__init48.call(this),o.prototype.__init49.call(this),o.prototype.__init50.call(this),o.prototype.__init51.call(this),o.prototype.__init52.call(this),o.prototype.__init53.call(this),o.prototype.__init54.call(this),o.prototype.__init55.call(this),o.prototype.__init56.call(this),o.prototype.__init57.call(this),o.prototype.__init58.call(this),o.prototype.__init59.call(this),o.prototype.__init60.call(this),o.prototype.__init61.call(this),o.prototype.__init62.call(this),o.prototype.__init63.call(this),o.prototype.__init64.call(this),o.prototype.__init65.call(this),o.prototype.__init66.call(this),o.prototype.__init67.call(this),o.prototype.__init68.call(this),o.prototype.__init69.call(this),o.prototype.__init70.call(this),o.prototype.__init71.call(this),o.prototype.__init72.call(this),o.prototype.__init73.call(this),o.prototype.__init74.call(this),o.prototype.__init75.call(this),o.prototype.__init76.call(this),o.prototype.__init77.call(this),o.prototype.__init78.call(this),o.prototype.__init79.call(this),o.prototype.__init80.call(this),o.prototype.__init81.call(this),o.prototype.__init82.call(this),o.prototype.__init83.call(this),o.prototype.__init84.call(this),o.prototype.__init85.call(this),o.prototype.__init86.call(this),o.prototype.__init87.call(this),o.prototype.__init88.call(this),o.prototype.__init89.call(this),o.prototype.__init90.call(this),o.prototype.__init91.call(this),o.prototype.__init92.call(this),o.prototype.__init93.call(this),o.prototype.__init94.call(this),o.prototype.__init95.call(this),o.prototype.__init96.call(this),o.prototype.__init97.call(this),o.prototype.__init98.call(this),o.prototype.__init99.call(this),o.prototype.__init100.call(this),o.prototype.__init101.call(this),o.prototype.__init102.call(this),o.prototype.__init103.call(this),o.prototype.__init104.call(this),o.prototype.__init105.call(this),o.prototype.__init106.call(this),o.prototype.__init107.call(this),o.prototype.__init108.call(this),o.prototype.__init109.call(this),o.prototype.__init110.call(this),o.prototype.__init111.call(this),o.prototype.__init112.call(this),o.prototype.__init113.call(this),o.prototype.__init114.call(this),o.prototype.__init115.call(this),o.prototype.__init116.call(this),o.prototype.__init117.call(this),o.prototype.__init118.call(this),o.prototype.__init119.call(this),o.prototype.__init120.call(this),o.prototype.__init121.call(this),o.prototype.__init122.call(this),o.prototype.__init123.call(this),o.prototype.__init124.call(this),o.prototype.__init125.call(this),o.prototype.__init126.call(this),this.client=t.client,this.commands=[],this.commandOptions=t.commandOptions,this.multiExec=s(t.multiExec,()=>!1)}__init(){this.exec=async()=>{if(0===this.commands.length)throw Error("Pipeline is empty");let t=this.multiExec?["multi-exec"]:["pipeline"];return(await this.client.request({path:t,body:Object.values(this.commands).map(t=>t.command)})).map(({error:t,result:e},i)=>{if(t)throw new l(`Command ${i+1} [ ${this.commands[i].command[0]} ] failed: ${t}`);return this.commands[i].deserialize(e)})}}length(){return this.commands.length}chain(t){return this.commands.push(t),this}__init2(){this.append=(...t)=>this.chain(new _(t,this.commandOptions))}__init3(){this.bitcount=(...t)=>this.chain(new f(t,this.commandOptions))}__init4(){this.bitop=(t,e,i,...n)=>this.chain(new y([t,e,i,...n],this.commandOptions))}__init5(){this.bitpos=(...t)=>this.chain(new w(t,this.commandOptions))}__init6(){this.copy=(...t)=>this.chain(new g(t,this.commandOptions))}__init7(){this.zdiffstore=(...t)=>this.chain(new eJ(t,this.commandOptions))}__init8(){this.dbsize=()=>this.chain(new b(this.commandOptions))}__init9(){this.decr=(...t)=>this.chain(new v(t,this.commandOptions))}__init10(){this.decrby=(...t)=>this.chain(new x(t,this.commandOptions))}__init11(){this.del=(...t)=>this.chain(new O(t,this.commandOptions))}__init12(){this.echo=(...t)=>this.chain(new k(t,this.commandOptions))}__init13(){this.eval=(...t)=>this.chain(new E(t,this.commandOptions))}__init14(){this.evalsha=(...t)=>this.chain(new A(t,this.commandOptions))}__init15(){this.exists=(...t)=>this.chain(new S(t,this.commandOptions))}__init16(){this.expire=(...t)=>this.chain(new P(t,this.commandOptions))}__init17(){this.expireat=(...t)=>this.chain(new T(t,this.commandOptions))}__init18(){this.flushall=t=>this.chain(new R(t,this.commandOptions))}__init19(){this.flushdb=(...t)=>this.chain(new C(t,this.commandOptions))}__init20(){this.get=(...t)=>this.chain(new M(t,this.commandOptions))}__init21(){this.getbit=(...t)=>this.chain(new z(t,this.commandOptions))}__init22(){this.getdel=(...t)=>this.chain(new q(t,this.commandOptions))}__init23(){this.getrange=(...t)=>this.chain(new F(t,this.commandOptions))}__init24(){this.getset=(t,e)=>this.chain(new U([t,e],this.commandOptions))}__init25(){this.hdel=(...t)=>this.chain(new $(t,this.commandOptions))}__init26(){this.hexists=(...t)=>this.chain(new W(t,this.commandOptions))}__init27(){this.hget=(...t)=>this.chain(new L(t,this.commandOptions))}__init28(){this.hgetall=(...t)=>this.chain(new H(t,this.commandOptions))}__init29(){this.hincrby=(...t)=>this.chain(new V(t,this.commandOptions))}__init30(){this.hincrbyfloat=(...t)=>this.chain(new G(t,this.commandOptions))}__init31(){this.hkeys=(...t)=>this.chain(new J(t,this.commandOptions))}__init32(){this.hlen=(...t)=>this.chain(new Y(t,this.commandOptions))}__init33(){this.hmget=(...t)=>this.chain(new X(t,this.commandOptions))}__init34(){this.hmset=(t,e)=>this.chain(new Q([t,e],this.commandOptions))}__init35(){this.hrandfield=(t,e,i)=>this.chain(new Z([t,e,i],this.commandOptions))}__init36(){this.hscan=(...t)=>this.chain(new tt(t,this.commandOptions))}__init37(){this.hset=(t,e)=>this.chain(new te([t,e],this.commandOptions))}__init38(){this.hsetnx=(t,e,i)=>this.chain(new ti([t,e,i],this.commandOptions))}__init39(){this.hstrlen=(...t)=>this.chain(new tn(t,this.commandOptions))}__init40(){this.hvals=(...t)=>this.chain(new ts(t,this.commandOptions))}__init41(){this.incr=(...t)=>this.chain(new tr(t,this.commandOptions))}__init42(){this.incrby=(...t)=>this.chain(new to(t,this.commandOptions))}__init43(){this.incrbyfloat=(...t)=>this.chain(new ta(t,this.commandOptions))}__init44(){this.keys=(...t)=>this.chain(new tT(t,this.commandOptions))}__init45(){this.lindex=(...t)=>this.chain(new tR(t,this.commandOptions))}__init46(){this.linsert=(t,e,i,n)=>this.chain(new tC([t,e,i,n],this.commandOptions))}__init47(){this.llen=(...t)=>this.chain(new tI(t,this.commandOptions))}__init48(){this.lmove=(...t)=>this.chain(new tK(t,this.commandOptions))}__init49(){this.lpop=(...t)=>this.chain(new tj(t,this.commandOptions))}__init50(){this.lpos=(...t)=>this.chain(new tD(t,this.commandOptions))}__init51(){this.lpush=(t,...e)=>this.chain(new tB([t,...e],this.commandOptions))}__init52(){this.lpushx=(t,...e)=>this.chain(new tN([t,...e],this.commandOptions))}__init53(){this.lrange=(...t)=>this.chain(new tM(t,this.commandOptions))}__init54(){this.lrem=(t,e,i)=>this.chain(new tz([t,e,i],this.commandOptions))}__init55(){this.lset=(t,e,i)=>this.chain(new tq([t,e,i],this.commandOptions))}__init56(){this.ltrim=(...t)=>this.chain(new tF(t,this.commandOptions))}__init57(){this.mget=(...t)=>this.chain(new tU(t,this.commandOptions))}__init58(){this.mset=t=>this.chain(new t$([t],this.commandOptions))}__init59(){this.msetnx=t=>this.chain(new tW([t],this.commandOptions))}__init60(){this.persist=(...t)=>this.chain(new tL(t,this.commandOptions))}__init61(){this.pexpire=(...t)=>this.chain(new tH(t,this.commandOptions))}__init62(){this.pexpireat=(...t)=>this.chain(new tV(t,this.commandOptions))}__init63(){this.pfadd=(...t)=>this.chain(new tG(t,this.commandOptions))}__init64(){this.pfcount=(...t)=>this.chain(new tJ(t,this.commandOptions))}__init65(){this.pfmerge=(...t)=>this.chain(new tY(t,this.commandOptions))}__init66(){this.ping=t=>this.chain(new tX(t,this.commandOptions))}__init67(){this.psetex=(t,e,i)=>this.chain(new tQ([t,e,i],this.commandOptions))}__init68(){this.pttl=(...t)=>this.chain(new tZ(t,this.commandOptions))}__init69(){this.publish=(...t)=>this.chain(new t1(t,this.commandOptions))}__init70(){this.randomkey=()=>this.chain(new t0(this.commandOptions))}__init71(){this.rename=(...t)=>this.chain(new t2(t,this.commandOptions))}__init72(){this.renamenx=(...t)=>this.chain(new t4(t,this.commandOptions))}__init73(){this.rpop=(...t)=>this.chain(new t3(t,this.commandOptions))}__init74(){this.rpush=(t,...e)=>this.chain(new t5([t,...e],this.commandOptions))}__init75(){this.rpushx=(t,...e)=>this.chain(new t8([t,...e],this.commandOptions))}__init76(){this.sadd=(t,...e)=>this.chain(new t6([t,...e],this.commandOptions))}__init77(){this.scan=(...t)=>this.chain(new t9(t,this.commandOptions))}__init78(){this.scard=(...t)=>this.chain(new t7(t,this.commandOptions))}__init79(){this.scriptExists=(...t)=>this.chain(new et(t,this.commandOptions))}__init80(){this.scriptFlush=(...t)=>this.chain(new ee(t,this.commandOptions))}__init81(){this.scriptLoad=(...t)=>this.chain(new ei(t,this.commandOptions))}__init82(){this.sdiff=(...t)=>this.chain(new en(t,this.commandOptions))}__init83(){this.sdiffstore=(...t)=>this.chain(new es(t,this.commandOptions))}__init84(){this.set=(t,e,i)=>this.chain(new er([t,e,i],this.commandOptions))}__init85(){this.setbit=(...t)=>this.chain(new eo(t,this.commandOptions))}__init86(){this.setex=(t,e,i)=>this.chain(new ea([t,e,i],this.commandOptions))}__init87(){this.setnx=(t,e)=>this.chain(new el([t,e],this.commandOptions))}__init88(){this.setrange=(...t)=>this.chain(new ec(t,this.commandOptions))}__init89(){this.sinter=(...t)=>this.chain(new eh(t,this.commandOptions))}__init90(){this.sinterstore=(...t)=>this.chain(new eu(t,this.commandOptions))}__init91(){this.sismember=(t,e)=>this.chain(new ep([t,e],this.commandOptions))}__init92(){this.smembers=(...t)=>this.chain(new ed(t,this.commandOptions))}__init93(){this.smismember=(t,e)=>this.chain(new em([t,e],this.commandOptions))}__init94(){this.smove=(t,e,i)=>this.chain(new e_([t,e,i],this.commandOptions))}__init95(){this.spop=(...t)=>this.chain(new ef(t,this.commandOptions))}__init96(){this.srandmember=(...t)=>this.chain(new ey(t,this.commandOptions))}__init97(){this.srem=(t,...e)=>this.chain(new ew([t,...e],this.commandOptions))}__init98(){this.sscan=(...t)=>this.chain(new eg(t,this.commandOptions))}__init99(){this.strlen=(...t)=>this.chain(new eb(t,this.commandOptions))}__init100(){this.sunion=(...t)=>this.chain(new ev(t,this.commandOptions))}__init101(){this.sunionstore=(...t)=>this.chain(new ex(t,this.commandOptions))}__init102(){this.time=()=>this.chain(new eO(this.commandOptions))}__init103(){this.touch=(...t)=>this.chain(new ek(t,this.commandOptions))}__init104(){this.ttl=(...t)=>this.chain(new eE(t,this.commandOptions))}__init105(){this.type=(...t)=>this.chain(new eA(t,this.commandOptions))}__init106(){this.unlink=(...t)=>this.chain(new eS(t,this.commandOptions))}__init107(){this.zadd=(...t)=>(t[1],this.chain(new eR([t[0],t[1],...t.slice(2)],this.commandOptions)))}__init108(){this.zcard=(...t)=>this.chain(new eC(t,this.commandOptions))}__init109(){this.zcount=(...t)=>this.chain(new eI(t,this.commandOptions))}__init110(){this.zincrby=(t,e,i)=>this.chain(new eK([t,e,i],this.commandOptions))}__init111(){this.zinterstore=(...t)=>this.chain(new ej(t,this.commandOptions))}__init112(){this.zlexcount=(...t)=>this.chain(new eD(t,this.commandOptions))}__init113(){this.zmscore=(...t)=>this.chain(new eY(t,this.commandOptions))}__init114(){this.zpopmax=(...t)=>this.chain(new eB(t,this.commandOptions))}__init115(){this.zpopmin=(...t)=>this.chain(new eN(t,this.commandOptions))}__init116(){this.zrange=(...t)=>this.chain(new eM(t,this.commandOptions))}__init117(){this.zrank=(t,e)=>this.chain(new ez([t,e],this.commandOptions))}__init118(){this.zrem=(t,...e)=>this.chain(new eq([t,...e],this.commandOptions))}__init119(){this.zremrangebylex=(...t)=>this.chain(new eF(t,this.commandOptions))}__init120(){this.zremrangebyrank=(...t)=>this.chain(new eU(t,this.commandOptions))}__init121(){this.zremrangebyscore=(...t)=>this.chain(new e$(t,this.commandOptions))}__init122(){this.zrevrank=(t,e)=>this.chain(new eW([t,e],this.commandOptions))}__init123(){this.zscan=(...t)=>this.chain(new eL(t,this.commandOptions))}__init124(){this.zscore=(t,e)=>this.chain(new eH([t,e],this.commandOptions))}__init125(){this.zunionstore=(...t)=>this.chain(new eG(t,this.commandOptions))}__init126(){this.zunion=(...t)=>this.chain(new eV(t,this.commandOptions))}get json(){return{arrappend:(...t)=>this.chain(new tl(t,this.commandOptions)),arrindex:(...t)=>this.chain(new tc(t,this.commandOptions)),arrinsert:(...t)=>this.chain(new th(t,this.commandOptions)),arrlen:(...t)=>this.chain(new tu(t,this.commandOptions)),arrpop:(...t)=>this.chain(new tp(t,this.commandOptions)),arrtrim:(...t)=>this.chain(new td(t,this.commandOptions)),clear:(...t)=>this.chain(new tm(t,this.commandOptions)),del:(...t)=>this.chain(new t_(t,this.commandOptions)),forget:(...t)=>this.chain(new tf(t,this.commandOptions)),geoadd:(...t)=>this.chain(new I(t,this.commandOptions)),geodist:(...t)=>this.chain(new K(t,this.commandOptions)),geopos:(...t)=>this.chain(new j(t,this.commandOptions)),geohash:(...t)=>this.chain(new D(t,this.commandOptions)),geosearch:(...t)=>this.chain(new B(t,this.commandOptions)),geosearchstore:(...t)=>this.chain(new N(t,this.commandOptions)),get:(...t)=>this.chain(new ty(t,this.commandOptions)),mget:(...t)=>this.chain(new tw(t,this.commandOptions)),numincrby:(...t)=>this.chain(new tg(t,this.commandOptions)),nummultby:(...t)=>this.chain(new tb(t,this.commandOptions)),objkeys:(...t)=>this.chain(new tv(t,this.commandOptions)),objlen:(...t)=>this.chain(new tx(t,this.commandOptions)),resp:(...t)=>this.chain(new tO(t,this.commandOptions)),set:(...t)=>this.chain(new tk(t,this.commandOptions)),strappend:(...t)=>this.chain(new tE(t,this.commandOptions)),strlen:(...t)=>this.chain(new tA(t,this.commandOptions)),toggle:(...t)=>this.chain(new tS(t,this.commandOptions)),type:(...t)=>this.chain(new tP(t,this.commandOptions))}}},eQ=n(i(98354)),eZ=n(i(55625)),e1=class{constructor(t,e){this.redis=t,this.sha1=this.digest(e),this.script=e}async eval(t,e){return await this.redis.eval(this.script,t,e)}async evalsha(t,e){return await this.redis.evalsha(this.sha1,t,e)}async exec(t,e){return await this.redis.evalsha(this.sha1,t,e).catch(async i=>{if(i instanceof Error&&i.message.toLowerCase().includes("noscript"))return await this.redis.eval(this.script,t,e);throw i})}digest(t){return eQ.default.stringify(eZ.default.call(void 0,t))}},e0=a=class{constructor(t,e){a.prototype.__init127.call(this),a.prototype.__init128.call(this),a.prototype.__init129.call(this),a.prototype.__init130.call(this),a.prototype.__init131.call(this),a.prototype.__init132.call(this),a.prototype.__init133.call(this),a.prototype.__init134.call(this),a.prototype.__init135.call(this),a.prototype.__init136.call(this),a.prototype.__init137.call(this),a.prototype.__init138.call(this),a.prototype.__init139.call(this),a.prototype.__init140.call(this),a.prototype.__init141.call(this),a.prototype.__init142.call(this),a.prototype.__init143.call(this),a.prototype.__init144.call(this),a.prototype.__init145.call(this),a.prototype.__init146.call(this),a.prototype.__init147.call(this),a.prototype.__init148.call(this),a.prototype.__init149.call(this),a.prototype.__init150.call(this),a.prototype.__init151.call(this),a.prototype.__init152.call(this),a.prototype.__init153.call(this),a.prototype.__init154.call(this),a.prototype.__init155.call(this),a.prototype.__init156.call(this),a.prototype.__init157.call(this),a.prototype.__init158.call(this),a.prototype.__init159.call(this),a.prototype.__init160.call(this),a.prototype.__init161.call(this),a.prototype.__init162.call(this),a.prototype.__init163.call(this),a.prototype.__init164.call(this),a.prototype.__init165.call(this),a.prototype.__init166.call(this),a.prototype.__init167.call(this),a.prototype.__init168.call(this),a.prototype.__init169.call(this),a.prototype.__init170.call(this),a.prototype.__init171.call(this),a.prototype.__init172.call(this),a.prototype.__init173.call(this),a.prototype.__init174.call(this),a.prototype.__init175.call(this),a.prototype.__init176.call(this),a.prototype.__init177.call(this),a.prototype.__init178.call(this),a.prototype.__init179.call(this),a.prototype.__init180.call(this),a.prototype.__init181.call(this),a.prototype.__init182.call(this),a.prototype.__init183.call(this),a.prototype.__init184.call(this),a.prototype.__init185.call(this),a.prototype.__init186.call(this),a.prototype.__init187.call(this),a.prototype.__init188.call(this),a.prototype.__init189.call(this),a.prototype.__init190.call(this),a.prototype.__init191.call(this),a.prototype.__init192.call(this),a.prototype.__init193.call(this),a.prototype.__init194.call(this),a.prototype.__init195.call(this),a.prototype.__init196.call(this),a.prototype.__init197.call(this),a.prototype.__init198.call(this),a.prototype.__init199.call(this),a.prototype.__init200.call(this),a.prototype.__init201.call(this),a.prototype.__init202.call(this),a.prototype.__init203.call(this),a.prototype.__init204.call(this),a.prototype.__init205.call(this),a.prototype.__init206.call(this),a.prototype.__init207.call(this),a.prototype.__init208.call(this),a.prototype.__init209.call(this),a.prototype.__init210.call(this),a.prototype.__init211.call(this),a.prototype.__init212.call(this),a.prototype.__init213.call(this),a.prototype.__init214.call(this),a.prototype.__init215.call(this),a.prototype.__init216.call(this),a.prototype.__init217.call(this),a.prototype.__init218.call(this),a.prototype.__init219.call(this),a.prototype.__init220.call(this),a.prototype.__init221.call(this),a.prototype.__init222.call(this),a.prototype.__init223.call(this),a.prototype.__init224.call(this),a.prototype.__init225.call(this),a.prototype.__init226.call(this),a.prototype.__init227.call(this),a.prototype.__init228.call(this),a.prototype.__init229.call(this),a.prototype.__init230.call(this),a.prototype.__init231.call(this),a.prototype.__init232.call(this),a.prototype.__init233.call(this),a.prototype.__init234.call(this),a.prototype.__init235.call(this),a.prototype.__init236.call(this),a.prototype.__init237.call(this),a.prototype.__init238.call(this),a.prototype.__init239.call(this),a.prototype.__init240.call(this),a.prototype.__init241.call(this),a.prototype.__init242.call(this),a.prototype.__init243.call(this),a.prototype.__init244.call(this),a.prototype.__init245.call(this),a.prototype.__init246.call(this),a.prototype.__init247.call(this),a.prototype.__init248.call(this),a.prototype.__init249.call(this),a.prototype.__init250.call(this),a.prototype.__init251.call(this),a.prototype.__init252.call(this),a.prototype.__init253.call(this),a.prototype.__init254.call(this),a.prototype.__init255.call(this),a.prototype.__init256.call(this),a.prototype.__init257.call(this),this.client=t,this.opts=e,this.enableTelemetry=s(r([e,"optionalAccess",t=>t.enableTelemetry]),()=>!0)}get json(){return{arrappend:(...t)=>new tl(t,this.opts).exec(this.client),arrindex:(...t)=>new tc(t,this.opts).exec(this.client),arrinsert:(...t)=>new th(t,this.opts).exec(this.client),arrlen:(...t)=>new tu(t,this.opts).exec(this.client),arrpop:(...t)=>new tp(t,this.opts).exec(this.client),arrtrim:(...t)=>new td(t,this.opts).exec(this.client),clear:(...t)=>new tm(t,this.opts).exec(this.client),del:(...t)=>new t_(t,this.opts).exec(this.client),forget:(...t)=>new tf(t,this.opts).exec(this.client),geoadd:(...t)=>new I(t,this.opts).exec(this.client),geopos:(...t)=>new j(t,this.opts).exec(this.client),geodist:(...t)=>new K(t,this.opts).exec(this.client),geohash:(...t)=>new D(t,this.opts).exec(this.client),geosearch:(...t)=>new B(t,this.opts).exec(this.client),geosearchstore:(...t)=>new N(t,this.opts).exec(this.client),get:(...t)=>new ty(t,this.opts).exec(this.client),mget:(...t)=>new tw(t,this.opts).exec(this.client),numincrby:(...t)=>new tg(t,this.opts).exec(this.client),nummultby:(...t)=>new tb(t,this.opts).exec(this.client),objkeys:(...t)=>new tv(t,this.opts).exec(this.client),objlen:(...t)=>new tx(t,this.opts).exec(this.client),resp:(...t)=>new tO(t,this.opts).exec(this.client),set:(...t)=>new tk(t,this.opts).exec(this.client),strappend:(...t)=>new tE(t,this.opts).exec(this.client),strlen:(...t)=>new tA(t,this.opts).exec(this.client),toggle:(...t)=>new tS(t,this.opts).exec(this.client),type:(...t)=>new tP(t,this.opts).exec(this.client)}}__init127(){this.use=t=>{let e=this.client.request.bind(this.client);this.client.request=i=>t(i,e)}}__init128(){this.addTelemetry=t=>{if(this.enableTelemetry)try{this.client.mergeTelemetry(t)}catch(t){}}}createScript(t){return new e1(this,t)}__init129(){this.pipeline=()=>new eX({client:this.client,commandOptions:this.opts,multiExec:!1})}__init130(){this.multi=()=>new eX({client:this.client,commandOptions:this.opts,multiExec:!0})}__init131(){this.append=(...t)=>new _(t,this.opts).exec(this.client)}__init132(){this.bitcount=(...t)=>new f(t,this.opts).exec(this.client)}__init133(){this.bitop=(t,e,i,...n)=>new y([t,e,i,...n],this.opts).exec(this.client)}__init134(){this.bitpos=(...t)=>new w(t,this.opts).exec(this.client)}__init135(){this.copy=(...t)=>new g(t,this.opts).exec(this.client)}__init136(){this.dbsize=()=>new b(this.opts).exec(this.client)}__init137(){this.decr=(...t)=>new v(t,this.opts).exec(this.client)}__init138(){this.decrby=(...t)=>new x(t,this.opts).exec(this.client)}__init139(){this.del=(...t)=>new O(t,this.opts).exec(this.client)}__init140(){this.echo=(...t)=>new k(t,this.opts).exec(this.client)}__init141(){this.eval=(...t)=>new E(t,this.opts).exec(this.client)}__init142(){this.evalsha=(...t)=>new A(t,this.opts).exec(this.client)}__init143(){this.exists=(...t)=>new S(t,this.opts).exec(this.client)}__init144(){this.expire=(...t)=>new P(t,this.opts).exec(this.client)}__init145(){this.expireat=(...t)=>new T(t,this.opts).exec(this.client)}__init146(){this.flushall=t=>new R(t,this.opts).exec(this.client)}__init147(){this.flushdb=(...t)=>new C(t,this.opts).exec(this.client)}__init148(){this.get=(...t)=>new M(t,this.opts).exec(this.client)}__init149(){this.getbit=(...t)=>new z(t,this.opts).exec(this.client)}__init150(){this.getdel=(...t)=>new q(t,this.opts).exec(this.client)}__init151(){this.getrange=(...t)=>new F(t,this.opts).exec(this.client)}__init152(){this.getset=(t,e)=>new U([t,e],this.opts).exec(this.client)}__init153(){this.hdel=(...t)=>new $(t,this.opts).exec(this.client)}__init154(){this.hexists=(...t)=>new W(t,this.opts).exec(this.client)}__init155(){this.hget=(...t)=>new L(t,this.opts).exec(this.client)}__init156(){this.hgetall=(...t)=>new H(t,this.opts).exec(this.client)}__init157(){this.hincrby=(...t)=>new V(t,this.opts).exec(this.client)}__init158(){this.hincrbyfloat=(...t)=>new G(t,this.opts).exec(this.client)}__init159(){this.hkeys=(...t)=>new J(t,this.opts).exec(this.client)}__init160(){this.hlen=(...t)=>new Y(t,this.opts).exec(this.client)}__init161(){this.hmget=(...t)=>new X(t,this.opts).exec(this.client)}__init162(){this.hmset=(t,e)=>new Q([t,e],this.opts).exec(this.client)}__init163(){this.hrandfield=(t,e,i)=>new Z([t,e,i],this.opts).exec(this.client)}__init164(){this.hscan=(...t)=>new tt(t,this.opts).exec(this.client)}__init165(){this.hset=(t,e)=>new te([t,e],this.opts).exec(this.client)}__init166(){this.hsetnx=(t,e,i)=>new ti([t,e,i],this.opts).exec(this.client)}__init167(){this.hstrlen=(...t)=>new tn(t,this.opts).exec(this.client)}__init168(){this.hvals=(...t)=>new ts(t,this.opts).exec(this.client)}__init169(){this.incr=(...t)=>new tr(t,this.opts).exec(this.client)}__init170(){this.incrby=(...t)=>new to(t,this.opts).exec(this.client)}__init171(){this.incrbyfloat=(...t)=>new ta(t,this.opts).exec(this.client)}__init172(){this.keys=(...t)=>new tT(t,this.opts).exec(this.client)}__init173(){this.lindex=(...t)=>new tR(t,this.opts).exec(this.client)}__init174(){this.linsert=(t,e,i,n)=>new tC([t,e,i,n],this.opts).exec(this.client)}__init175(){this.llen=(...t)=>new tI(t,this.opts).exec(this.client)}__init176(){this.lmove=(...t)=>new tK(t,this.opts).exec(this.client)}__init177(){this.lpop=(...t)=>new tj(t,this.opts).exec(this.client)}__init178(){this.lpos=(...t)=>new tD(t,this.opts).exec(this.client)}__init179(){this.lpush=(t,...e)=>new tB([t,...e],this.opts).exec(this.client)}__init180(){this.lpushx=(t,...e)=>new tN([t,...e],this.opts).exec(this.client)}__init181(){this.lrange=(...t)=>new tM(t,this.opts).exec(this.client)}__init182(){this.lrem=(t,e,i)=>new tz([t,e,i],this.opts).exec(this.client)}__init183(){this.lset=(t,e,i)=>new tq([t,e,i],this.opts).exec(this.client)}__init184(){this.ltrim=(...t)=>new tF(t,this.opts).exec(this.client)}__init185(){this.mget=(...t)=>new tU(t,this.opts).exec(this.client)}__init186(){this.mset=t=>new t$([t],this.opts).exec(this.client)}__init187(){this.msetnx=t=>new tW([t],this.opts).exec(this.client)}__init188(){this.persist=(...t)=>new tL(t,this.opts).exec(this.client)}__init189(){this.pexpire=(...t)=>new tH(t,this.opts).exec(this.client)}__init190(){this.pexpireat=(...t)=>new tV(t,this.opts).exec(this.client)}__init191(){this.pfadd=(...t)=>new tG(t,this.opts).exec(this.client)}__init192(){this.pfcount=(...t)=>new tJ(t,this.opts).exec(this.client)}__init193(){this.pfmerge=(...t)=>new tY(t,this.opts).exec(this.client)}__init194(){this.ping=t=>new tX(t,this.opts).exec(this.client)}__init195(){this.psetex=(t,e,i)=>new tQ([t,e,i],this.opts).exec(this.client)}__init196(){this.pttl=(...t)=>new tZ(t,this.opts).exec(this.client)}__init197(){this.publish=(...t)=>new t1(t,this.opts).exec(this.client)}__init198(){this.randomkey=()=>new t0().exec(this.client)}__init199(){this.rename=(...t)=>new t2(t,this.opts).exec(this.client)}__init200(){this.renamenx=(...t)=>new t4(t,this.opts).exec(this.client)}__init201(){this.rpop=(...t)=>new t3(t,this.opts).exec(this.client)}__init202(){this.rpush=(t,...e)=>new t5([t,...e],this.opts).exec(this.client)}__init203(){this.rpushx=(t,...e)=>new t8([t,...e],this.opts).exec(this.client)}__init204(){this.sadd=(t,...e)=>new t6([t,...e],this.opts).exec(this.client)}__init205(){this.scan=(...t)=>new t9(t,this.opts).exec(this.client)}__init206(){this.scard=(...t)=>new t7(t,this.opts).exec(this.client)}__init207(){this.scriptExists=(...t)=>new et(t,this.opts).exec(this.client)}__init208(){this.scriptFlush=(...t)=>new ee(t,this.opts).exec(this.client)}__init209(){this.scriptLoad=(...t)=>new ei(t,this.opts).exec(this.client)}__init210(){this.sdiff=(...t)=>new en(t,this.opts).exec(this.client)}__init211(){this.sdiffstore=(...t)=>new es(t,this.opts).exec(this.client)}__init212(){this.set=(t,e,i)=>new er([t,e,i],this.opts).exec(this.client)}__init213(){this.setbit=(...t)=>new eo(t,this.opts).exec(this.client)}__init214(){this.setex=(t,e,i)=>new ea([t,e,i],this.opts).exec(this.client)}__init215(){this.setnx=(t,e)=>new el([t,e],this.opts).exec(this.client)}__init216(){this.setrange=(...t)=>new ec(t,this.opts).exec(this.client)}__init217(){this.sinter=(...t)=>new eh(t,this.opts).exec(this.client)}__init218(){this.sinterstore=(...t)=>new eu(t,this.opts).exec(this.client)}__init219(){this.sismember=(t,e)=>new ep([t,e],this.opts).exec(this.client)}__init220(){this.smismember=(t,e)=>new em([t,e],this.opts).exec(this.client)}__init221(){this.smembers=(...t)=>new ed(t,this.opts).exec(this.client)}__init222(){this.smove=(t,e,i)=>new e_([t,e,i],this.opts).exec(this.client)}__init223(){this.spop=(...t)=>new ef(t,this.opts).exec(this.client)}__init224(){this.srandmember=(...t)=>new ey(t,this.opts).exec(this.client)}__init225(){this.srem=(t,...e)=>new ew([t,...e],this.opts).exec(this.client)}__init226(){this.sscan=(...t)=>new eg(t,this.opts).exec(this.client)}__init227(){this.strlen=(...t)=>new eb(t,this.opts).exec(this.client)}__init228(){this.sunion=(...t)=>new ev(t,this.opts).exec(this.client)}__init229(){this.sunionstore=(...t)=>new ex(t,this.opts).exec(this.client)}__init230(){this.time=()=>new eO().exec(this.client)}__init231(){this.touch=(...t)=>new ek(t,this.opts).exec(this.client)}__init232(){this.ttl=(...t)=>new eE(t,this.opts).exec(this.client)}__init233(){this.type=(...t)=>new eA(t,this.opts).exec(this.client)}__init234(){this.unlink=(...t)=>new eS(t,this.opts).exec(this.client)}__init235(){this.xadd=(...t)=>new eP(t,this.opts).exec(this.client)}__init236(){this.xrange=(...t)=>new eT(t,this.opts).exec(this.client)}__init237(){this.zadd=(...t)=>(t[1],new eR([t[0],t[1],...t.slice(2)],this.opts).exec(this.client))}__init238(){this.zcard=(...t)=>new eC(t,this.opts).exec(this.client)}__init239(){this.zcount=(...t)=>new eI(t,this.opts).exec(this.client)}__init240(){this.zdiffstore=(...t)=>new eJ(t,this.opts).exec(this.client)}__init241(){this.zincrby=(t,e,i)=>new eK([t,e,i],this.opts).exec(this.client)}__init242(){this.zinterstore=(...t)=>new ej(t,this.opts).exec(this.client)}__init243(){this.zlexcount=(...t)=>new eD(t,this.opts).exec(this.client)}__init244(){this.zmscore=(...t)=>new eY(t,this.opts).exec(this.client)}__init245(){this.zpopmax=(...t)=>new eB(t,this.opts).exec(this.client)}__init246(){this.zpopmin=(...t)=>new eN(t,this.opts).exec(this.client)}__init247(){this.zrange=(...t)=>new eM(t,this.opts).exec(this.client)}__init248(){this.zrank=(t,e)=>new ez([t,e],this.opts).exec(this.client)}__init249(){this.zrem=(t,...e)=>new eq([t,...e],this.opts).exec(this.client)}__init250(){this.zremrangebylex=(...t)=>new eF(t,this.opts).exec(this.client)}__init251(){this.zremrangebyrank=(...t)=>new eU(t,this.opts).exec(this.client)}__init252(){this.zremrangebyscore=(...t)=>new e$(t,this.opts).exec(this.client)}__init253(){this.zrevrank=(t,e)=>new eW([t,e],this.opts).exec(this.client)}__init254(){this.zscan=(...t)=>new eL(t,this.opts).exec(this.client)}__init255(){this.zscore=(t,e)=>new eH([t,e],this.opts).exec(this.client)}__init256(){this.zunion=(...t)=>new eV(t,this.opts).exec(this.client)}__init257(){this.zunionstore=(...t)=>new eG(t,this.opts).exec(this.client)}};e.a=c,e.b=e0,e.c="v1.25.1"},89541:function(t,e,i){"use strict";var n=i(85145).Buffer,s=i(48523);function r(t){let e;let i=t[0],n=1;for(;n<t.length;){let s=t[n],r=t[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==i)return;"access"===s||"optionalAccess"===s?(e=i,i=r(i)):("call"===s||"optionalCall"===s)&&(i=r((...t)=>i.call(e,...t)),e=void 0)}return i}var o=i(76782);typeof atob>"u"&&(i.g.atob=function(t){return n.from(t,"base64").toString("utf-8")});var a=class t extends o.b{constructor(t){if("request"in t){super(t);return}(t.url.startsWith(" ")||t.url.endsWith(" ")||/\r|\n/.test(t.url))&&console.warn("The redis url contains whitespace or newline, which can cause errors!"),(t.token.startsWith(" ")||t.token.endsWith(" ")||/\r|\n/.test(t.token))&&console.warn("The redis token contains whitespace or newline, which can cause errors!"),super(new o.a({baseUrl:t.url,retry:t.retry,headers:{authorization:`Bearer ${t.token}`},agent:t.agent,responseEncoding:t.responseEncoding,cache:t.cache||"no-store"}),{automaticDeserialization:t.automaticDeserialization,enableTelemetry:!s.env.UPSTASH_DISABLE_TELEMETRY}),this.addTelemetry({runtime:"string"==typeof EdgeRuntime?"edge-light":`node@${s.version}`,platform:s.env.VERCEL?"vercel":s.env.AWS_REGION?"aws":"unknown",sdk:`@upstash/redis@${o.c}`})}static fromEnv(e){if(typeof r([s,"optionalAccess",t=>t.env])>"u")throw Error('Unable to get environment variables, `process.env` is undefined. If you are deploying to cloudflare, please import from "@upstash/redis/cloudflare" instead');let i=r([s,"optionalAccess",t=>t.env,"access",t=>t.UPSTASH_REDIS_REST_URL]);if(!i)throw Error("Unable to find environment variable: `UPSTASH_REDIS_REST_URL`");let n=r([s,"optionalAccess",t=>t.env,"access",t=>t.UPSTASH_REDIS_REST_TOKEN]);if(!n)throw Error("Unable to find environment variable: `UPSTASH_REDIS_REST_TOKEN`");return new t({...e,url:i,token:n})}};e.s=a},49030:function(t,e,i){var n;t.exports=n||function(t,e){if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==i.g&&i.g.crypto&&(n=i.g.crypto),!n)try{n=i(42480)}catch(t){}var n,s=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(t){}}throw Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function t(){}return function(e){var i;return t.prototype=e,i=new t,t.prototype=null,i}}(),o={},a=o.lib={},l=a.Base={extend:function(t){var e=r(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=l.extend({init:function(t,e){t=this.words=t||[],void 0!=e?this.sigBytes=e:this.sigBytes=4*t.length},toString:function(t){return(t||u).stringify(this)},concat:function(t){var e=this.words,i=t.words,n=this.sigBytes,s=t.sigBytes;if(this.clamp(),n%4)for(var r=0;r<s;r++){var o=i[r>>>2]>>>24-r%4*8&255;e[n+r>>>2]|=o<<24-(n+r)%4*8}else for(var a=0;a<s;a+=4)e[n+a>>>2]=i[a>>>2];return this.sigBytes+=s,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=t.ceil(i/4)},clone:function(){var t=l.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],i=0;i<t;i+=4)e.push(s());return new c.init(e,t)}}),h=o.enc={},u=h.Hex={stringify:function(t){for(var e=t.words,i=t.sigBytes,n=[],s=0;s<i;s++){var r=e[s>>>2]>>>24-s%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,i=[],n=0;n<e;n+=2)i[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new c.init(i,e/2)}},p=h.Latin1={stringify:function(t){for(var e=t.words,i=t.sigBytes,n=[],s=0;s<i;s++){var r=e[s>>>2]>>>24-s%4*8&255;n.push(String.fromCharCode(r))}return n.join("")},parse:function(t){for(var e=t.length,i=[],n=0;n<e;n++)i[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new c.init(i,e)}},d=h.Utf8={stringify:function(t){try{return decodeURIComponent(escape(p.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return p.parse(unescape(encodeURIComponent(t)))}},m=a.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=d.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var i,n=this._data,s=n.words,r=n.sigBytes,o=this.blockSize,a=r/(4*o),l=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*o,h=t.min(4*l,r);if(l){for(var u=0;u<l;u+=o)this._doProcessBlock(s,u);i=s.splice(0,l),n.sigBytes-=h}return new c.init(i,h)},clone:function(){var t=l.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});a.Hasher=m.extend({cfg:l.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,i){return new t.init(i).finalize(e)}},_createHmacHelper:function(t){return function(e,i){return new _.HMAC.init(t,i).finalize(e)}}});var _=o.algo={};return o}(Math)},98354:function(t,e,i){t.exports=i(49030).enc.Hex},55625:function(t,e,i){var n,s,r,o,a,l,c;t.exports=(r=(s=(n=i(49030)).lib).WordArray,o=s.Hasher,a=n.algo,l=[],c=a.SHA1=o.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var i=this._hash.words,n=i[0],s=i[1],r=i[2],o=i[3],a=i[4],c=0;c<80;c++){if(c<16)l[c]=0|t[e+c];else{var h=l[c-3]^l[c-8]^l[c-14]^l[c-16];l[c]=h<<1|h>>>31}var u=(n<<5|n>>>27)+a+l[c];c<20?u+=(s&r|~s&o)+1518500249:c<40?u+=(s^r^o)+1859775393:c<60?u+=(s&r|s&o|r&o)-1894007588:u+=(s^r^o)-899497514,a=o,o=r,r=s<<30|s>>>2,s=n,n=u}i[0]=i[0]+n|0,i[1]=i[1]+s|0,i[2]=i[2]+r|0,i[3]=i[3]+o|0,i[4]=i[4]+a|0},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,n=8*t.sigBytes;return e[n>>>5]|=128<<24-n%32,e[(n+64>>>9<<4)+14]=Math.floor(i/4294967296),e[(n+64>>>9<<4)+15]=i,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}}),n.SHA1=o._createHelper(c),n.HmacSHA1=o._createHmacHelper(c),n.SHA1)},14785:function(t,e,i){"use strict";let n;i.d(e,{ZP:function(){return ig}});let s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,r=Object.keys,o=Array.isArray;function a(t,e){return"object"!=typeof e||r(e).forEach(function(i){t[i]=e[i]}),t}"undefined"==typeof Promise||s.Promise||(s.Promise=Promise);let l=Object.getPrototypeOf,c={}.hasOwnProperty;function h(t,e){return c.call(t,e)}function u(t,e){"function"==typeof e&&(e=e(l(t))),("undefined"==typeof Reflect?r:Reflect.ownKeys)(e).forEach(i=>{d(t,i,e[i])})}let p=Object.defineProperty;function d(t,e,i,n){p(t,e,a(i&&h(i,"get")&&"function"==typeof i.get?{get:i.get,set:i.set,configurable:!0}:{value:i,configurable:!0,writable:!0},n))}function m(t){return{from:function(e){return t.prototype=Object.create(e.prototype),d(t.prototype,"constructor",t),{extend:u.bind(null,t.prototype)}}}}let _=Object.getOwnPropertyDescriptor;function f(t,e){let i;return _(t,e)||(i=l(t))&&f(i,e)}let y=[].slice;function w(t,e,i){return y.call(t,e,i)}function g(t,e){return e(t)}function b(t){if(!t)throw Error("Assertion Failed")}function v(t){s.setImmediate?setImmediate(t):setTimeout(t,0)}function x(t,e){return t.reduce((t,i,n)=>{var s=e(i,n);return s&&(t[s[0]]=s[1]),t},{})}function O(t,e){if(h(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var i=[],n=0,s=e.length;n<s;++n){var r=O(t,e[n]);i.push(r)}return i}var o=e.indexOf(".");if(-1!==o){var a=t[e.substr(0,o)];return void 0===a?void 0:O(a,e.substr(o+1))}}function k(t,e,i){if(t&&void 0!==e&&(!("isFrozen"in Object)||!Object.isFrozen(t))){if("string"!=typeof e&&"length"in e){b("string"!=typeof i&&"length"in i);for(var n=0,s=e.length;n<s;++n)k(t,e[n],i[n])}else{var r=e.indexOf(".");if(-1!==r){var a=e.substr(0,r),l=e.substr(r+1);if(""===l)void 0===i?o(t)&&!isNaN(parseInt(a))?t.splice(a,1):delete t[a]:t[a]=i;else{var c=t[a];c&&h(t,a)||(c=t[a]={}),k(c,l,i)}}else void 0===i?o(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=i}}}function E(t){var e={};for(var i in t)h(t,i)&&(e[i]=t[i]);return e}let A=[].concat;function S(t){return A.apply([],t)}let P="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(S([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>s[t]),T=P.map(t=>s[t]);x(P,t=>[t,!0]);let R=null;function C(t){R="undefined"!=typeof WeakMap&&new WeakMap;let e=function t(e){if(!e||"object"!=typeof e)return e;let i=R&&R.get(e);if(i)return i;if(o(e)){i=[],R&&R.set(e,i);for(var n=0,s=e.length;n<s;++n)i.push(t(e[n]))}else if(T.indexOf(e.constructor)>=0)i=e;else{let n=l(e);for(var r in i=n===Object.prototype?{}:Object.create(n),R&&R.set(e,i),e)h(e,r)&&(i[r]=t(e[r]))}return i}(t);return R=null,e}let{toString:I}={};function K(t){return I.call(t).slice(8,-1)}let j="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",D="symbol"==typeof j?function(t){var e;return null!=t&&(e=t[j])&&e.apply(t)}:function(){return null},B={};function N(t){var e,i,n,s;if(1==arguments.length){if(o(t))return t.slice();if(this===B&&"string"==typeof t)return[t];if(s=D(t)){for(i=[];!(n=s.next()).done;)i.push(n.value);return i}if(null==t)return[t];if("number"==typeof(e=t.length)){for(i=Array(e);e--;)i[e]=t[e];return i}return[t]}for(e=arguments.length,i=Array(e);e--;)i[e]=arguments[e];return i}let M="undefined"!=typeof Symbol?t=>"AsyncFunction"===t[Symbol.toStringTag]:()=>!1;var z="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href),q=()=>!0;let F=!Error("").stack;function U(){if(F)try{throw U.arguments,Error()}catch(t){return t}return Error()}function $(t,e){var i=t.stack;return i?(e=e||0,0===i.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),i.split("\n").slice(e).filter(q).map(t=>"\n"+t).join("")):""}var W=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],L=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(W),H={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function V(t,e){this._e=U(),this.name=t,this.message=e}function G(t,e){return t+". Errors: "+Object.keys(e).map(t=>e[t].toString()).filter((t,e,i)=>i.indexOf(t)===e).join("\n")}function J(t,e,i,n){this._e=U(),this.failures=e,this.failedKeys=n,this.successCount=i,this.message=G(t,e)}function Y(t,e){this._e=U(),this.name="BulkError",this.failures=Object.keys(e).map(t=>e[t]),this.failuresByPos=e,this.message=G(t,e)}m(V).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+$(this._e,2))}},toString:function(){return this.name+": "+this.message}}),m(J).from(V),m(Y).from(V);var X=L.reduce((t,e)=>(t[e]=e+"Error",t),{}),Q=L.reduce((t,e)=>{var i=e+"Error";function n(t,n){this._e=U(),this.name=i,t?"string"==typeof t?(this.message=`${t}${n?"\n "+n:""}`,this.inner=n||null):"object"==typeof t&&(this.message=`${t.name} ${t.message}`,this.inner=t):(this.message=H[e]||i,this.inner=null)}return m(n).from(V),t[e]=n,t},{});Q.Syntax=SyntaxError,Q.Type=TypeError,Q.Range=RangeError;var Z=W.reduce((t,e)=>(t[e+"Error"]=Q[e],t),{}),tt=L.reduce((t,e)=>(-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=Q[e]),t),{});function te(){}function ti(t){return t}function tn(t,e){return null==t||t===ti?e:function(i){return e(t(i))}}function ts(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function tr(t,e){return t===te?e:function(){var i=t.apply(this,arguments);void 0!==i&&(arguments[0]=i);var n=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var r=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?ts(n,this.onsuccess):n),s&&(this.onerror=this.onerror?ts(s,this.onerror):s),void 0!==r?r:i}}function to(t,e){return t===te?e:function(){t.apply(this,arguments);var i=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?ts(i,this.onsuccess):i),n&&(this.onerror=this.onerror?ts(n,this.onerror):n)}}function ta(t,e){return t===te?e:function(i){var n=t.apply(this,arguments);a(i,n);var s=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?ts(s,this.onsuccess):s),r&&(this.onerror=this.onerror?ts(r,this.onerror):r),void 0===n?void 0===o?void 0:o:a(n,o)}}function tl(t,e){return t===te?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function tc(t,e){return t===te?e:function(){var i=t.apply(this,arguments);if(i&&"function"==typeof i.then){for(var n=this,s=arguments.length,r=Array(s);s--;)r[s]=arguments[s];return i.then(function(){return e.apply(n,r)})}return e.apply(this,arguments)}}tt.ModifyError=J,tt.DexieError=V,tt.BulkError=Y;var th={};let[tu,tp,td]="undefined"==typeof Promise?[]:(()=>{let t=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[t,l(t),t];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,l(e),t]})(),tm=tp&&tp.then,t_=tu&&tu.constructor,tf=!!td;var ty=!1,tw=td?()=>{td.then(tz)}:s.setImmediate?setImmediate.bind(null,tz):s.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{tz(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(tz,0)},tg=function(t,e){tP.push([t,e]),tv&&(tw(),tv=!1)},tb=!0,tv=!0,tx=[],tO=[],tk=null,tE=ti,tA={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:t7,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{t7(t[0],t[1])}catch(t){}})}},tS=tA,tP=[],tT=0,tR=[];function tC(t){if("object"!=typeof this)throw TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=te,this._lib=!1;var e=this._PSD=tS;if(z&&(this._stackHolder=U(),this._prev=null,this._numPrev=0),"function"!=typeof t){if(t!==th)throw TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&tj(this,this._value))}this._state=null,this._value=null,++e.ref,function t(e,i){try{i(i=>{if(null===e._state){if(i===e)throw TypeError("A promise cannot be resolved with itself.");var n=e._lib&&tq();i&&"function"==typeof i.then?t(e,(t,e)=>{i instanceof tC?i._then(t,e):i.then(t,e)}):(e._state=!0,e._value=i,tD(e)),n&&tF()}},tj.bind(null,e))}catch(t){tj(e,t)}}(this,t)}let tI={get:function(){var t=tS,e=tJ;function i(i,n){var s=!t.global&&(t!==tS||e!==tJ);let r=s&&!tZ();var o=new tC((e,o)=>{tB(this,new tK(t8(i,t,s,r),t8(n,t,s,r),e,o,t))});return z&&tM(o,this),o}return i.prototype=th,i},set:function(t){d(this,"then",t&&t.prototype===th?tI:{get:function(){return t},set:tI.set})}};function tK(t,e,i,n,s){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=i,this.reject=n,this.psd=s}function tj(t,e){if(tO.push(e),null===t._state){var i=t._lib&&tq();e=tE(e),t._state=!1,t._value=e,z&&null!==e&&"object"==typeof e&&!e._promise&&function(t,e,i){try{t.apply(null,void 0)}catch(t){e&&e(t)}}(()=>{var i=f(e,"stack");e._promise=t,d(e,"stack",{get:()=>ty?i&&(i.get?i.get.apply(e):i.value):t.stack})}),tx.some(e=>e._value===t._value)||tx.push(t),tD(t),i&&tF()}}function tD(t){var e=t._listeners;t._listeners=[];for(var i=0,n=e.length;i<n;++i)tB(t,e[i]);var s=t._PSD;--s.ref||s.finalize(),0===tT&&(++tT,tg(()=>{0==--tT&&tU()},[]))}function tB(t,e){if(null!==t._state){var i=t._state?e.onFulfilled:e.onRejected;if(null===i)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++tT,tg(tN,[i,t,e])}else t._listeners.push(e)}function tN(t,e,i){try{tk=e;var n,s=e._value;e._state?n=t(s):(tO.length&&(tO=[]),n=t(s),-1===tO.indexOf(s)&&function(t){for(var e=tx.length;e;)if(tx[--e]._value===t._value)return void tx.splice(e,1)}(e)),i.resolve(n)}catch(t){i.reject(t)}finally{tk=null,0==--tT&&tU(),--i.psd.ref||i.psd.finalize()}}function tM(t,e){var i=e?e._numPrev+1:0;i<100&&(t._prev=e,t._numPrev=i)}function tz(){tq()&&tF()}function tq(){var t=tb;return tb=!1,tv=!1,t}function tF(){var t,e,i;do for(;tP.length>0;)for(t=tP,tP=[],i=t.length,e=0;e<i;++e){var n=t[e];n[0].apply(null,n[1])}while(tP.length>0);tb=!0,tv=!0}function tU(){var t=tx;tx=[],t.forEach(t=>{t._PSD.onunhandled.call(null,t._value,t)});for(var e=tR.slice(0),i=e.length;i;)e[--i]()}function t$(t){return new tC(th,!1,t)}function tW(t,e){var i=tS;return function(){var n=tq(),s=tS;try{return t4(i,!0),t.apply(this,arguments)}catch(t){e&&e(t)}finally{t4(s,!1),n&&tF()}}}u(tC.prototype,{then:tI,_then:function(t,e){tB(this,new tK(null,null,t,e,tS))},catch:function(t){if(1==arguments.length)return this.then(null,t);var e=arguments[0],i=arguments[1];return"function"==typeof e?this.then(null,t=>t instanceof e?i(t):t$(t)):this.then(null,t=>t&&t.name===e?i(t):t$(t))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),t$(e)))},stack:{get:function(){if(this._stack)return this._stack;try{ty=!0;var t=(function t(e,i,n){if(i.length===n)return i;var s="";if(!1===e._state){var r,o,a=e._value;null!=a?(r=a.name||"Error",o=a.message||a,s=$(a,0)):(r=a,o=""),i.push(r+(o?": "+o:"")+s)}return z&&((s=$(e._stackHolder,2))&&-1===i.indexOf(s)&&i.push(s),e._prev&&t(e._prev,i,n)),i})(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{ty=!1}}},timeout:function(t,e){return t<1/0?new tC((i,n)=>{var s=setTimeout(()=>n(new Q.Timeout(e)),t);this.then(i,n).finally(clearTimeout.bind(null,s))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&d(tC.prototype,Symbol.toStringTag,"Dexie.Promise"),tA.env=t3(),u(tC,{all:function(){var t=N.apply(null,arguments).map(t1);return new tC(function(e,i){0===t.length&&e([]);var n=t.length;t.forEach((s,r)=>tC.resolve(s).then(i=>{t[r]=i,--n||e(t)},i))})},resolve:t=>{if(t instanceof tC)return t;if(t&&"function"==typeof t.then)return new tC((e,i)=>{t.then(e,i)});var e=new tC(th,!0,t);return tM(e,tk),e},reject:t$,race:function(){var t=N.apply(null,arguments).map(t1);return new tC((e,i)=>{t.map(t=>tC.resolve(t).then(e,i))})},PSD:{get:()=>tS,set:t=>tS=t},totalEchoes:{get:()=>tJ},newPSD:tX,usePSD:t5,scheduler:{get:()=>tg,set:t=>{tg=t}},rejectionMapper:{get:()=>tE,set:t=>{tE=t}},follow:(t,e)=>new tC((i,n)=>tX((e,i)=>{var n=tS;n.unhandleds=[],n.onunhandled=i,n.finalize=ts(function(){var t;t=()=>{0===this.unhandleds.length?e():i(this.unhandleds[0])},tR.push(function e(){t(),tR.splice(tR.indexOf(e),1)}),++tT,tg(()=>{0==--tT&&tU()},[])},n.finalize),t()},e,i,n))}),t_&&(t_.allSettled&&d(tC,"allSettled",function(){let t=N.apply(null,arguments).map(t1);return new tC(e=>{0===t.length&&e([]);let i=t.length,n=Array(i);t.forEach((t,s)=>tC.resolve(t).then(t=>n[s]={status:"fulfilled",value:t},t=>n[s]={status:"rejected",reason:t}).then(()=>--i||e(n)))})}),t_.any&&"undefined"!=typeof AggregateError&&d(tC,"any",function(){let t=N.apply(null,arguments).map(t1);return new tC((e,i)=>{0===t.length&&i(AggregateError([]));let n=t.length,s=Array(n);t.forEach((t,r)=>tC.resolve(t).then(t=>e(t),t=>{s[r]=t,--n||i(AggregateError(s))}))})}));let tL={awaits:0,echoes:0,id:0};var tH=0,tV=[],tG=0,tJ=0,tY=0;function tX(t,e,i,n){var s=tS,r=Object.create(s);r.parent=s,r.ref=0,r.global=!1,r.id=++tY;var o=tA.env;r.env=tf?{Promise:tC,PromiseProp:{value:tC,configurable:!0,writable:!0},all:tC.all,race:tC.race,allSettled:tC.allSettled,any:tC.any,resolve:tC.resolve,reject:tC.reject,nthen:t6(o.nthen,r),gthen:t6(o.gthen,r)}:{},e&&a(r,e),++s.ref,r.finalize=function(){--this.parent.ref||this.parent.finalize()};var l=t5(r,t,i,n);return 0===r.ref&&r.finalize(),l}function tQ(){return tL.id||(tL.id=++tH),++tL.awaits,tL.echoes+=100,tL.id}function tZ(){return!!tL.awaits&&(0==--tL.awaits&&(tL.id=0),tL.echoes=100*tL.awaits,!0)}function t1(t){return tL.echoes&&t&&t.constructor===t_?(tQ(),t.then(t=>(tZ(),t),t=>(tZ(),et(t)))):t}function t0(t){++tJ,tL.echoes&&0!=--tL.echoes||(tL.echoes=tL.id=0),tV.push(tS),t4(t,!0)}function t2(){var t=tV[tV.length-1];tV.pop(),t4(t,!1)}function t4(t,e){var i,n=tS;if((e?!tL.echoes||tG++&&t===tS:!tG||--tG&&t===tS)||(i=e?t0.bind(null,t):t2,tm.call(tu,i)),t!==tS&&(tS=t,n===tA&&(tA.env=t3()),tf)){var r=tA.env.Promise,o=t.env;tp.then=o.nthen,r.prototype.then=o.gthen,(n.global||t.global)&&(Object.defineProperty(s,"Promise",o.PromiseProp),r.all=o.all,r.race=o.race,r.resolve=o.resolve,r.reject=o.reject,o.allSettled&&(r.allSettled=o.allSettled),o.any&&(r.any=o.any))}}function t3(){var t=s.Promise;return tf?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:tp.then,gthen:t.prototype.then}:{}}function t5(t,e,i,n,s){var r=tS;try{return t4(t,!0),e(i,n,s)}finally{t4(r,!1)}}function t8(t,e,i,n){return"function"!=typeof t?t:function(){var s,r=tS;i&&tQ(),t4(e,!0);try{return t.apply(this,arguments)}finally{t4(r,!1),n&&(s=tZ,tm.call(tu,s))}}}function t6(t,e){return function(i,n){return t.call(this,t8(i,e),t8(n,e))}}-1===(""+tm).indexOf("[native code]")&&(tQ=tZ=te);let t9="unhandledrejection";function t7(t,e){var i;try{i=e.onuncatched(t)}catch(t){}if(!1!==i)try{var n,r={promise:e,reason:t};if(s.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(t9,!0,!0),a(n,r)):s.CustomEvent&&a(n=new CustomEvent(t9,{detail:r}),r),n&&s.dispatchEvent&&(dispatchEvent(n),!s.PromiseRejectionEvent&&s.onunhandledrejection))try{s.onunhandledrejection(n)}catch(t){}z&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch(t){}}var et=tC.reject;let ee="3.2.4",ei=String.fromCharCode(65535),en=-1/0,es="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",er="String expected.",eo=[],ea="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),el=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),ec="__dbnames",eh="readonly",eu="readwrite";function ep(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}let ed={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function em(t){return"string"!=typeof t||/\./.test(t)?t=>t:e=>(void 0===e[t]&&t in e&&delete(e=C(e))[t],e)}class e_{_trans(t,e,i){let n=this._tx||tS.trans,s=this.name;function r(t,i,n){if(!n.schema[s])throw new Q.NotFound("Table "+s+" not part of transaction");return e(n.idbtrans,n)}let o=tq();try{return n&&n.db===this.db?n===tS.trans?n._promise(t,r,i):tX(()=>n._promise(t,r,i),{trans:n,transless:tS.transless||tS}):function t(e,i,n,s){if(e.idbdb&&(e._state.openComplete||tS.letThrough||e._vip)){var r=e._createTransaction(i,n,e._dbSchema);try{r.create(),e._state.PR1398_maxLoop=3}catch(r){return r.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>t(e,i,n,s))):et(r)}return r._promise(i,(t,e)=>tX(()=>(tS.trans=r,s(t,e,r)))).then(t=>r._completion.then(()=>t))}if(e._state.openComplete)return et(new Q.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return et(new Q.DatabaseClosed);e.open().catch(te)}return e._state.dbReadyPromise.then(()=>t(e,i,n,s))}(this.db,t,[this.name],r)}finally{o&&tF()}}get(t,e){return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",e=>this.core.get({trans:e,key:t}).then(t=>this.hook.reading.fire(t))).then(e)}where(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(o(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);let e=r(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);let i=this.schema.indexes.concat(this.schema.primKey).filter(t=>t.compound&&e.every(e=>t.keyPath.indexOf(e)>=0)&&t.keyPath.every(t=>e.indexOf(t)>=0))[0];if(i&&this.db._maxKey!==ei)return this.where(i.name).equals(i.keyPath.map(e=>t[e]));!i&&z&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${e.join("+")}]`);let{idxByName:n}=this.schema,s=this.db._deps.indexedDB;function a(t,e){try{return 0===s.cmp(t,e)}catch(t){return!1}}let[l,c]=e.reduce(([e,i],s)=>{let r=n[s],l=t[s];return[e||r,e||!r?ep(i,r&&r.multi?t=>{let e=O(t,s);return o(e)&&e.some(t=>a(l,t))}:t=>a(l,O(t,s))):i]},[null,null]);return l?this.where(l.name).equals(t[l.keyPath]).filter(c):i?this.filter(c):this.where(e).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,o(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;let e=e=>{if(!e)return e;let i=Object.create(t.prototype);for(var n in e)if(h(e,n))try{i[n]=e[n]}catch(t){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t}defineClass(){return this.mapToClass(function(t){a(this,t)})}add(t,e){let{auto:i,keyPath:n}=this.schema.primKey,s=t;return n&&i&&(s=em(n)(t)),this._trans("readwrite",t=>this.core.mutate({trans:t,type:"add",keys:null!=e?[e]:null,values:[s]})).then(t=>t.numFailures?tC.reject(t.failures[0]):t.lastResult).then(e=>{if(n)try{k(t,n,e)}catch(t){}return e})}update(t,e){if("object"!=typeof t||o(t))return this.where(":id").equals(t).modify(e);{let i=O(t,this.schema.primKey.keyPath);if(void 0===i)return et(new Q.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof e?r(e).forEach(i=>{k(t,i,e[i])}):e(t,{value:t,primKey:i})}catch(t){}return this.where(":id").equals(i).modify(e)}}put(t,e){let{auto:i,keyPath:n}=this.schema.primKey,s=t;return n&&i&&(s=em(n)(t)),this._trans("readwrite",t=>this.core.mutate({trans:t,type:"put",values:[s],keys:null!=e?[e]:null})).then(t=>t.numFailures?tC.reject(t.failures[0]):t.lastResult).then(e=>{if(n)try{k(t,n,e)}catch(t){}return e})}delete(t){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"delete",keys:[t]})).then(t=>t.numFailures?tC.reject(t.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:ed})).then(t=>t.numFailures?tC.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",e=>this.core.getMany({keys:t,trans:e}).then(t=>t.map(t=>this.hook.reading.fire(t))))}bulkAdd(t,e,i){let n=Array.isArray(e)?e:void 0,s=(i=i||(n?void 0:e))?i.allKeys:void 0;return this._trans("readwrite",e=>{let{auto:i,keyPath:r}=this.schema.primKey;if(r&&n)throw new Q.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(n&&n.length!==t.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");let o=t.length,a=r&&i?t.map(em(r)):t;return this.core.mutate({trans:e,type:"add",keys:n,values:a,wantResults:s}).then(({numFailures:t,results:e,lastResult:i,failures:n})=>{if(0===t)return s?e:i;throw new Y(`${this.name}.bulkAdd(): ${t} of ${o} operations failed`,n)})})}bulkPut(t,e,i){let n=Array.isArray(e)?e:void 0,s=(i=i||(n?void 0:e))?i.allKeys:void 0;return this._trans("readwrite",e=>{let{auto:i,keyPath:r}=this.schema.primKey;if(r&&n)throw new Q.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(n&&n.length!==t.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");let o=t.length,a=r&&i?t.map(em(r)):t;return this.core.mutate({trans:e,type:"put",keys:n,values:a,wantResults:s}).then(({numFailures:t,results:e,lastResult:i,failures:n})=>{if(0===t)return s?e:i;throw new Y(`${this.name}.bulkPut(): ${t} of ${o} operations failed`,n)})})}bulkDelete(t){let e=t.length;return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"delete",keys:t})).then(({numFailures:t,lastResult:i,failures:n})=>{if(0===t)return i;throw new Y(`${this.name}.bulkDelete(): ${t} of ${e} operations failed`,n)})}}function ef(t){var e={},i=function(i,n){if(n){for(var s=arguments.length,r=Array(s-1);--s;)r[s-1]=arguments[s];return e[i].subscribe.apply(null,r),t}if("string"==typeof i)return e[i]};i.addEventType=a;for(var n=1,s=arguments.length;n<s;++n)a(arguments[n]);return i;function a(t,n,s){if("object"!=typeof t){n||(n=tl),s||(s=te);var l={subscribers:[],fire:s,subscribe:function(t){-1===l.subscribers.indexOf(t)&&(l.subscribers.push(t),l.fire=n(l.fire,t))},unsubscribe:function(t){l.subscribers=l.subscribers.filter(function(e){return e!==t}),l.fire=l.subscribers.reduce(n,s)}};return e[t]=i[t]=l,l}r(t).forEach(function(e){var i=t[e];if(o(i))a(e,t[e][0],t[e][1]);else{if("asap"!==i)throw new Q.InvalidArgument("Invalid event config");var n=a(e,ti,function(){for(var t=arguments.length,e=Array(t);t--;)e[t]=arguments[t];n.subscribers.forEach(function(t){v(function(){t.apply(null,e)})})})}})}}function ey(t,e){return m(e).from({prototype:t}),e}function ew(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function eg(t,e){t.filter=ep(t.filter,e)}function eb(t,e,i){var n=t.replayFilter;t.replayFilter=n?()=>ep(n(),e()):e,t.justLimit=i&&!n}function ev(t,e){if(t.isPrimKey)return e.primaryKey;let i=e.getIndexByKeyPath(t.index);if(!i)throw new Q.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return i}function ex(t,e,i){let n=ev(t,e.schema);return e.openCursor({trans:i,values:!t.keysOnly,reverse:"prev"===t.dir,unique:!!t.unique,query:{index:n,range:t.range}})}function eO(t,e,i,n){let s=t.replayFilter?ep(t.filter,t.replayFilter()):t.filter;if(t.or){let r={},o=(t,i,n)=>{if(!s||s(i,n,t=>i.stop(t),t=>i.fail(t))){var o=i.primaryKey,a=""+o;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(o)),h(r,a)||(r[a]=!0,e(t,i,n))}};return Promise.all([t.or._iterate(o,i),ek(ex(t,n,i),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}return ek(ex(t,n,i),ep(t.algorithm,s),e,!t.keysOnly&&t.valueMapper)}function ek(t,e,i,n){var s=tW(n?(t,e,s)=>i(n(t),e,s):i);return t.then(t=>{if(t)return t.start(()=>{var i=()=>t.continue();e&&!e(t,t=>i=t,e=>{t.stop(e),i=te},e=>{t.fail(e),i=te})||s(t.value,t,t=>i=t),i()})})}function eE(t,e){try{let i=eA(t),n=eA(e);if(i!==n)return"Array"===i?1:"Array"===n?-1:"binary"===i?1:"binary"===n?-1:"string"===i?1:"string"===n?-1:"Date"===i?1:"Date"!==n?NaN:-1;switch(i){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(t,e){let i=t.length,n=e.length,s=i<n?i:n;for(let i=0;i<s;++i)if(t[i]!==e[i])return t[i]<e[i]?-1:1;return i===n?0:i<n?-1:1}(eS(t),eS(e));case"Array":return function(t,e){let i=t.length,n=e.length,s=i<n?i:n;for(let i=0;i<s;++i){let n=eE(t[i],e[i]);if(0!==n)return n}return i===n?0:i<n?-1:1}(t,e)}}catch(t){}return NaN}function eA(t){let e=typeof t;if("object"!==e)return e;if(ArrayBuffer.isView(t))return"binary";let i=K(t);return"ArrayBuffer"===i?"binary":i}function eS(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class eP{_read(t,e){var i=this._ctx;return i.error?i.table._trans(null,et.bind(null,i.error)):i.table._trans("readonly",t).then(e)}_write(t){var e=this._ctx;return e.error?e.table._trans(null,et.bind(null,e.error)):e.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var e=this._ctx;e.algorithm=ep(e.algorithm,t)}_iterate(t,e){return eO(this._ctx,t,e,this._ctx.table.core)}clone(t){var e=Object.create(this.constructor.prototype),i=Object.create(this._ctx);return t&&a(i,t),e._ctx=i,e}raw(){return this._ctx.valueMapper=null,this}each(t){var e=this._ctx;return this._read(i=>eO(e,t,i,e.table.core))}count(t){return this._read(t=>{let e=this._ctx,i=e.table.core;if(ew(e,!0))return i.count({trans:t,query:{index:ev(e,i.schema),range:e.range}}).then(t=>Math.min(t,e.limit));var n=0;return eO(e,()=>(++n,!1),t,i).then(()=>n)}).then(t)}sortBy(t,e){let i=t.split(".").reverse(),n=i[0],s=i.length-1;function r(t,e){return e?r(t[i[e]],e-1):t[n]}var o="next"===this._ctx.dir?1:-1;function a(t,e){var i=r(t,s),n=r(e,s);return i<n?-o:i>n?o:0}return this.toArray(function(t){return t.sort(a)}).then(e)}toArray(t){return this._read(t=>{var e=this._ctx;if("next"===e.dir&&ew(e,!0)&&e.limit>0){let{valueMapper:i}=e,n=ev(e,e.table.core.schema);return e.table.core.query({trans:t,limit:e.limit,values:!0,query:{index:n,range:e.range}}).then(({result:t})=>i?t.map(i):t)}{let i=[];return eO(e,t=>i.push(t),t,e.table.core).then(()=>i)}},t)}offset(t){var e=this._ctx;return t<=0||(e.offset+=t,ew(e)?eb(e,()=>{var e=t;return(t,i)=>0===e||(1===e?--e:i(()=>{t.advance(e),e=0}),!1)}):eb(e,()=>{var e=t;return()=>--e<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),eb(this._ctx,()=>{var e=t;return function(t,i,n){return--e<=0&&i(n),e>=0}},!0),this}until(t,e){return eg(this._ctx,function(i,n,s){return!t(i.value)||(n(s),e)}),this}first(t){return this.limit(1).toArray(function(t){return t[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){var e;return eg(this._ctx,function(e){return t(e.value)}),(e=this._ctx).isMatch=ep(e.isMatch,t),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,i){t(i.key,i)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,i){t(i.primaryKey,i)})}keys(t){var e=this._ctx;e.keysOnly=!e.isMatch;var i=[];return this.each(function(t,e){i.push(e.key)}).then(function(){return i}).then(t)}primaryKeys(t){var e=this._ctx;if("next"===e.dir&&ew(e,!0)&&e.limit>0)return this._read(t=>{var i=ev(e,e.table.core.schema);return e.table.core.query({trans:t,values:!1,limit:e.limit,query:{index:i,range:e.range}})}).then(({result:t})=>t).then(t);e.keysOnly=!e.isMatch;var i=[];return this.each(function(t,e){i.push(e.primaryKey)}).then(function(){return i}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(t){return t[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var i={};return eg(this._ctx,function(t){var e=t.primaryKey.toString(),n=h(i,e);return i[e]=!0,!n}),this}modify(t){var e=this._ctx;return this._write(i=>{var n;if("function"==typeof t)n=t;else{var s=r(t),o=s.length;n=function(e){for(var i=!1,n=0;n<o;++n){var r=s[n],a=t[r];O(e,r)!==a&&(k(e,r,a),i=!0)}return i}}let a=e.table.core,{outbound:l,extractKey:c}=a.schema.primaryKey,h=this.db._options.modifyChunkSize||200,u=[],p=0,d=[],m=(t,e)=>{let{failures:i,numFailures:n}=e;for(let e of(p+=t-n,r(i)))u.push(i[e])};return this.clone().primaryKeys().then(s=>{let r=o=>{let u=Math.min(h,s.length-o);return a.getMany({trans:i,keys:s.slice(o,o+u),cache:"immutable"}).then(p=>{let d=[],_=[],f=l?[]:null,y=[];for(let t=0;t<u;++t){let e=p[t],i={value:C(e),primKey:s[o+t]};!1!==n.call(i,i.value,i)&&(null==i.value?y.push(s[o+t]):l||0===eE(c(e),c(i.value))?(_.push(i.value),l&&f.push(s[o+t])):(y.push(s[o+t]),d.push(i.value)))}let w=ew(e)&&e.limit===1/0&&("function"!=typeof t||t===eT)&&{index:e.index,range:e.range};return Promise.resolve(d.length>0&&a.mutate({trans:i,type:"add",values:d}).then(t=>{for(let e in t.failures)y.splice(parseInt(e),1);m(d.length,t)})).then(()=>(_.length>0||w&&"object"==typeof t)&&a.mutate({trans:i,type:"put",keys:f,values:_,criteria:w,changeSpec:"function"!=typeof t&&t}).then(t=>m(_.length,t))).then(()=>(y.length>0||w&&t===eT)&&a.mutate({trans:i,type:"delete",keys:y,criteria:w}).then(t=>m(y.length,t))).then(()=>s.length>o+u&&r(o+h))})};return r(0).then(()=>{if(u.length>0)throw new J("Error modifying one or more objects",u,p,d);return s.length})})})}delete(){var t=this._ctx,e=t.range;return ew(t)&&(t.isPrimKey&&!ea||3===e.type)?this._write(i=>{let{primaryKey:n}=t.table.core.schema;return t.table.core.count({trans:i,query:{index:n,range:e}}).then(n=>t.table.core.mutate({trans:i,type:"deleteRange",range:e}).then(({failures:t,lastResult:e,results:i,numFailures:s})=>{if(s)throw new J("Could not delete some values",Object.keys(t).map(e=>t[e]),n-s);return n-s}))}):this.modify(eT)}}let eT=(t,e)=>e.value=null;function eR(t,e){return t<e?-1:t===e?0:1}function eC(t,e){return t>e?-1:t===e?0:1}function eI(t,e,i){var n=t instanceof eN?new t.Collection(t):t;return n._ctx.error=i?new i(e):TypeError(e),n}function eK(t){return new t.Collection(t,()=>eB("")).limit(0)}function ej(t,e,i,n){var s,r,o,a,l,c,h,u=i.length;if(!i.every(t=>"string"==typeof t))return eI(t,er);function p(t){s="next"===t?t=>t.toUpperCase():t=>t.toLowerCase(),r="next"===t?t=>t.toLowerCase():t=>t.toUpperCase(),o="next"===t?eR:eC;var e=i.map(function(t){return{lower:r(t),upper:s(t)}}).sort(function(t,e){return o(t.lower,e.lower)});a=e.map(function(t){return t.upper}),l=e.map(function(t){return t.lower}),c=t,h="next"===t?"":n}p("next");var d=new t.Collection(t,()=>eD(a[0],l[u-1]+n));d._ondirectionchange=function(t){p(t)};var m=0;return d._addAlgorithm(function(t,i,n){var s=t.key;if("string"!=typeof s)return!1;var p=r(s);if(e(p,l,m))return!0;for(var d=null,_=m;_<u;++_){var f=function(t,e,i,n,s,r){for(var o=Math.min(t.length,n.length),a=-1,l=0;l<o;++l){var c=e[l];if(c!==n[l])return 0>s(t[l],i[l])?t.substr(0,l)+i[l]+i.substr(l+1):0>s(t[l],n[l])?t.substr(0,l)+n[l]+i.substr(l+1):a>=0?t.substr(0,a)+e[a]+i.substr(a+1):null;0>s(t[l],c)&&(a=l)}return o<n.length&&"next"===r?t+i.substr(t.length):o<t.length&&"prev"===r?t.substr(0,i.length):a<0?null:t.substr(0,a)+n[a]+i.substr(a+1)}(s,p,a[_],l[_],o,c);null===f&&null===d?m=_+1:(null===d||o(d,f)>0)&&(d=f)}return i(null!==d?function(){t.continue(d+h)}:n),!1}),d}function eD(t,e,i,n){return{type:2,lower:t,upper:e,lowerOpen:i,upperOpen:n}}function eB(t){return{type:1,lower:t,upper:t}}class eN{get Collection(){return this._ctx.table.db.Collection}between(t,e,i,n){i=!1!==i,n=!0===n;try{return this._cmp(t,e)>0||0===this._cmp(t,e)&&(i||n)&&(!i||!n)?eK(this):new this.Collection(this,()=>eD(t,e,!i,!n))}catch(t){return eI(this,es)}}equals(t){return null==t?eI(this,es):new this.Collection(this,()=>eB(t))}above(t){return null==t?eI(this,es):new this.Collection(this,()=>eD(t,void 0,!0))}aboveOrEqual(t){return null==t?eI(this,es):new this.Collection(this,()=>eD(t,void 0,!1))}below(t){return null==t?eI(this,es):new this.Collection(this,()=>eD(void 0,t,!1,!0))}belowOrEqual(t){return null==t?eI(this,es):new this.Collection(this,()=>eD(void 0,t))}startsWith(t){return"string"!=typeof t?eI(this,er):this.between(t,t+ei,!0,!0)}startsWithIgnoreCase(t){return""===t?this.startsWith(t):ej(this,(t,e)=>0===t.indexOf(e[0]),[t],ei)}equalsIgnoreCase(t){return ej(this,(t,e)=>t===e[0],[t],"")}anyOfIgnoreCase(){var t=N.apply(B,arguments);return 0===t.length?eK(this):ej(this,(t,e)=>-1!==e.indexOf(t),t,"")}startsWithAnyOfIgnoreCase(){var t=N.apply(B,arguments);return 0===t.length?eK(this):ej(this,(t,e)=>e.some(e=>0===t.indexOf(e)),t,ei)}anyOf(){let t=N.apply(B,arguments),e=this._cmp;try{t.sort(e)}catch(t){return eI(this,es)}if(0===t.length)return eK(this);let i=new this.Collection(this,()=>eD(t[0],t[t.length-1]));i._ondirectionchange=i=>{e="next"===i?this._ascending:this._descending,t.sort(e)};let n=0;return i._addAlgorithm((i,s,r)=>{let o=i.key;for(;e(o,t[n])>0;)if(++n===t.length)return s(r),!1;return 0===e(o,t[n])||(s(()=>{i.continue(t[n])}),!1)}),i}notEqual(t){return this.inAnyRange([[en,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let t=N.apply(B,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch(t){return eI(this,es)}let e=t.reduce((t,e)=>t?t.concat([[t[t.length-1][1],e]]):[[en,e]],null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,e){let i=this._cmp,n=this._ascending,s=this._descending,r=this._min,o=this._max;if(0===t.length)return eK(this);if(!t.every(t=>void 0!==t[0]&&void 0!==t[1]&&0>=n(t[0],t[1])))return eI(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Q.InvalidArgument);let a=!e||!1!==e.includeLowers,l=e&&!0===e.includeUppers,c,h=n;function u(t,e){return h(t[0],e[0])}try{(c=t.reduce(function(t,e){let n=0,s=t.length;for(;n<s;++n){let s=t[n];if(0>i(e[0],s[1])&&i(e[1],s[0])>0){s[0]=r(s[0],e[0]),s[1]=o(s[1],e[1]);break}}return n===s&&t.push(e),t},[])).sort(u)}catch(t){return eI(this,es)}let p=0,d=l?t=>n(t,c[p][1])>0:t=>n(t,c[p][1])>=0,m=a?t=>s(t,c[p][0])>0:t=>s(t,c[p][0])>=0,_=d,f=new this.Collection(this,()=>eD(c[0][0],c[c.length-1][1],!a,!l));return f._ondirectionchange=t=>{"next"===t?(_=d,h=n):(_=m,h=s),c.sort(u)},f._addAlgorithm((t,e,i)=>{for(var s=t.key;_(s);)if(++p===c.length)return e(i),!1;return!!(!d(s)&&!m(s))||(0===this._cmp(s,c[p][1])||0===this._cmp(s,c[p][0])||e(()=>{h===n?t.continue(c[p][0]):t.continue(c[p][1])}),!1)}),f}startsWithAnyOf(){let t=N.apply(B,arguments);return t.every(t=>"string"==typeof t)?0===t.length?eK(this):this.inAnyRange(t.map(t=>[t,t+ei])):eI(this,"startsWithAnyOf() only works with strings")}}function eM(t){return tW(function(e){return ez(e),t(e.target.error),!1})}function ez(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}let eq="storagemutated",eF="x-storagemutated-1",eU=ef(null,eq);class e${_lock(){return b(!tS.global),++this._reculock,1!==this._reculock||tS.global||(tS.lockOwnerFor=this),this}_unlock(){if(b(!tS.global),0==--this._reculock)for(tS.global||(tS.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{t5(t[1],t[0])}catch(t){}}return this}_locked(){return this._reculock&&tS.lockOwnerFor!==this}create(t){if(!this.mode)return this;let e=this.db.idbdb,i=this.db._state.dbOpenError;if(b(!this.idbtrans),!t&&!e)switch(i&&i.name){case"DatabaseClosedError":throw new Q.DatabaseClosed(i);case"MissingAPIError":throw new Q.MissingAPI(i.message,i);default:throw new Q.OpenFailed(i)}if(!this.active)throw new Q.TransactionInactive;return b(null===this._completion._state),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):e.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=tW(e=>{ez(e),this._reject(t.error)}),t.onabort=tW(e=>{ez(e),this.active&&this._reject(new Q.Abort(t.error)),this.active=!1,this.on("abort").fire(e)}),t.oncomplete=tW(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&eU.storagemutated.fire(t.mutatedParts)}),this}_promise(t,e,i){if("readwrite"===t&&"readwrite"!==this.mode)return et(new Q.ReadOnly("Transaction is readonly"));if(!this.active)return et(new Q.TransactionInactive);if(this._locked())return new tC((n,s)=>{this._blockedFuncs.push([()=>{this._promise(t,e,i).then(n,s)},tS])});if(i)return tX(()=>{var t=new tC((t,i)=>{this._lock();let n=e(t,i,this);n&&n.then&&n.then(t,i)});return t.finally(()=>this._unlock()),t._lib=!0,t});var n=new tC((t,i)=>{var n=e(t,i,this);n&&n.then&&n.then(t,i)});return n._lib=!0,n}_root(){return this.parent?this.parent._root():this}waitFor(t){var e=this._root();let i=tC.resolve(t);if(e._waitingFor)e._waitingFor=e._waitingFor.then(()=>i);else{e._waitingFor=i,e._waitingQueue=[];var n=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(n.get(-1/0).onsuccess=t)}()}var s=e._waitingFor;return new tC((t,n)=>{i.then(i=>e._waitingQueue.push(tW(t.bind(null,i))),t=>e._waitingQueue.push(tW(n.bind(null,t)))).finally(()=>{e._waitingFor===s&&(e._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Q.Abort))}table(t){let e=this._memoizedTables||(this._memoizedTables={});if(h(e,t))return e[t];let i=this.schema[t];if(!i)throw new Q.NotFound("Table "+t+" not part of transaction");let n=new this.db.Table(t,i,this);return n.core=this.db.core.table(t),e[t]=n,n}}function eW(t,e,i,n,s,r,o){return{name:t,keyPath:e,unique:i,multi:n,auto:s,compound:r,src:(i&&!o?"&":"")+(n?"*":"")+(s?"++":"")+eL(e)}}function eL(t){return"string"==typeof t?t:t?"["+[].join.call(t,"+")+"]":""}function eH(t,e,i){return{name:t,primKey:e,indexes:i,mappedClass:null,idxByName:x(i,t=>[t.name,t])}}let eV=t=>{try{return t.only([[]]),eV=()=>[[]],[[]]}catch(t){return eV=()=>ei,ei}};function eG(t){return null==t?()=>{}:"string"==typeof t?1===t.split(".").length?e=>e[t]:e=>O(e,t):e=>O(e,t)}function eJ(t){return[].slice.call(t)}let eY=0;function eX(t){return null==t?":id":"string"==typeof t?t:`[${t.join("+")}]`}function eQ({_novip:t},e){let i=e.db,n=function(t,e,{IDBKeyRange:i,indexedDB:n},s){var r;return{dbcore:(r=function(t,e,i){function n(t){if(3===t.type)return null;if(4===t.type)throw Error("Cannot convert never type to IDBKeyRange");let{lower:i,upper:n,lowerOpen:s,upperOpen:r}=t;return void 0===i?void 0===n?null:e.upperBound(n,!!r):void 0===n?e.lowerBound(i,!!s):e.bound(i,n,!!s,!!r)}let{schema:s,hasGetAll:r}=function(t,e){let i=eJ(t.objectStoreNames);return{schema:{name:t.name,tables:i.map(t=>e.objectStore(t)).map(t=>{let{keyPath:e,autoIncrement:i}=t,n=o(e),s=null==e,r={},a={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:s,compound:n,keyPath:e,autoIncrement:i,unique:!0,extractKey:eG(e)},indexes:eJ(t.indexNames).map(e=>t.index(e)).map(t=>{let{name:e,unique:i,multiEntry:n,keyPath:s}=t,a={name:e,compound:o(s),keyPath:s,unique:i,multiEntry:n,extractKey:eG(s)};return r[eX(s)]=a,a}),getIndexByKeyPath:t=>r[eX(t)]};return r[":id"]=a.primaryKey,null!=e&&(r[eX(e)]=a.primaryKey),a})},hasGetAll:i.length>0&&"getAll"in e.objectStore(i[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,i),a=s.tables.map(t=>(function(t){let e=t.name;return{name:e,schema:t,mutate:function({trans:t,type:i,keys:s,values:r,range:o}){return new Promise((a,l)=>{let c;a=tW(a);let h=t.objectStore(e),u=null==h.keyPath,p="put"===i||"add"===i;if(!p&&"delete"!==i&&"deleteRange"!==i)throw Error("Invalid operation type: "+i);let{length:d}=s||r||{length:1};if(s&&r&&s.length!==r.length)throw Error("Given keys array must have same length as given values array.");if(0===d)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let m=[],_=[],f=0,y=t=>{++f,ez(t)};if("deleteRange"===i){if(4===o.type)return a({numFailures:f,failures:_,results:[],lastResult:void 0});3===o.type?m.push(c=h.clear()):m.push(c=h.delete(n(o)))}else{let[t,e]=p?u?[r,s]:[r,null]:[s,null];if(p)for(let n=0;n<d;++n)m.push(c=e&&void 0!==e[n]?h[i](t[n],e[n]):h[i](t[n])),c.onerror=y;else for(let e=0;e<d;++e)m.push(c=h[i](t[e])),c.onerror=y}let w=t=>{let e=t.target.result;m.forEach((t,e)=>null!=t.error&&(_[e]=t.error)),a({numFailures:f,failures:_,results:"delete"===i?s:m.map(t=>t.result),lastResult:e})};c.onerror=t=>{y(t),w(t)},c.onsuccess=w})},getMany:({trans:t,keys:i})=>new Promise((n,s)=>{n=tW(n);let r=t.objectStore(e),o=i.length,a=Array(o),l,c=0,h=0,u=t=>{let e=t.target;a[e._pos]=e.result,++h===c&&n(a)},p=eM(s);for(let t=0;t<o;++t)null!=i[t]&&((l=r.get(i[t]))._pos=t,l.onsuccess=u,l.onerror=p,++c);0===c&&n(a)}),get:({trans:t,key:i})=>new Promise((n,s)=>{n=tW(n);let r=t.objectStore(e).get(i);r.onsuccess=t=>n(t.target.result),r.onerror=eM(s)}),query:t=>new Promise((i,s)=>{i=tW(i);let{trans:o,values:a,limit:l,query:c}=t,h=l===1/0?void 0:l,{index:u,range:p}=c,d=o.objectStore(e),m=u.isPrimaryKey?d:d.index(u.name),_=n(p);if(0===l)return i({result:[]});if(r){let t=a?m.getAll(_,h):m.getAllKeys(_,h);t.onsuccess=t=>i({result:t.target.result}),t.onerror=eM(s)}else{let t=0,e=!a&&"openKeyCursor"in m?m.openKeyCursor(_):m.openCursor(_),n=[];e.onsuccess=s=>{let r=e.result;return r?(n.push(a?r.value:r.primaryKey),++t===l?i({result:n}):void r.continue()):i({result:n})},e.onerror=eM(s)}}),openCursor:function({trans:t,values:i,query:s,reverse:r,unique:o}){return new Promise((a,l)=>{a=tW(a);let{index:c,range:h}=s,u=t.objectStore(e),p=c.isPrimaryKey?u:u.index(c.name),d=r?o?"prevunique":"prev":o?"nextunique":"next",m=!i&&"openKeyCursor"in p?p.openKeyCursor(n(h),d):p.openCursor(n(h),d);m.onerror=eM(l),m.onsuccess=tW(e=>{let i=m.result;if(!i)return void a(null);i.___id=++eY,i.done=!1;let n=i.continue.bind(i),s=i.continuePrimaryKey;s&&(s=s.bind(i));let r=i.advance.bind(i),o=()=>{throw Error("Cursor not stopped")};i.trans=t,i.stop=i.continue=i.continuePrimaryKey=i.advance=()=>{throw Error("Cursor not started")},i.fail=tW(l),i.next=function(){let t=1;return this.start(()=>t--?this.continue():this.stop()).then(()=>this)},i.start=t=>{let e=new Promise((t,e)=>{t=tW(t),m.onerror=eM(e),i.fail=e,i.stop=e=>{i.stop=i.continue=i.continuePrimaryKey=i.advance=o,t(e)}}),a=()=>{if(m.result)try{t()}catch(t){i.fail(t)}else i.done=!0,i.start=()=>{throw Error("Cursor behind last entry")},i.stop()};return m.onsuccess=tW(t=>{m.onsuccess=a,a()}),i.continue=n,i.continuePrimaryKey=s,i.advance=r,a(),e},a(i)},l)})},count({query:t,trans:i}){let{index:s,range:r}=t;return new Promise((t,o)=>{let a=i.objectStore(e),l=s.isPrimaryKey?a:a.index(s.name),c=n(r),h=c?l.count(c):l.count();h.onsuccess=tW(e=>t(e.target.result)),h.onerror=eM(o)})}}})(t)),l={};return a.forEach(t=>l[t.name]=t),{stack:"dbcore",transaction:t.transaction.bind(t),table(t){if(!l[t])throw Error(`Table '${t}' not found`);return l[t]},MIN_KEY:-1/0,MAX_KEY:eV(e),schema:s}}(e,i,s),t.dbcore.reduce((t,{create:e})=>({...t,...e(t)}),r))}}(t._middlewares,i,t._deps,e);t.core=n.dbcore,t.tables.forEach(e=>{let i=e.name;t.core.schema.tables.some(t=>t.name===i)&&(e.core=t.core.table(i),t[i]instanceof t.Table&&(t[i].core=e.core))})}function eZ({_novip:t},e,i,n){i.forEach(i=>{let s=n[i];e.forEach(e=>{let n=f(e,i);(!n||"value"in n&&void 0===n.value)&&(e===t.Transaction.prototype||e instanceof t.Transaction?d(e,i,{get(){return this.table(i)},set(t){p(this,i,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):e[i]=new t.Table(i,s))})})}function e1({_novip:t},e){e.forEach(e=>{for(let i in e)e[i]instanceof t.Table&&delete e[i]})}function e0(t,e){return t._cfg.version-e._cfg.version}function e2(t,e){let i;let n={del:[],add:[],change:[]};for(i in t)e[i]||n.del.push(i);for(i in e){let s=t[i],r=e[i];if(s){let t={name:i,def:r,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")==""+(r.primKey.keyPath||"")&&(s.primKey.auto===r.primKey.auto||ea)){let e;let i=s.idxByName,o=r.idxByName;for(e in i)o[e]||t.del.push(e);for(e in o){let n=i[e],s=o[e];n?n.src!==s.src&&t.change.push(s):t.add.push(s)}(t.del.length>0||t.add.length>0||t.change.length>0)&&n.change.push(t)}else t.recreate=!0,n.change.push(t)}else n.add.push([i,r])}return n}function e4(t,e,i,n){let s=t.db.createObjectStore(e,i.keyPath?{keyPath:i.keyPath,autoIncrement:i.auto}:{autoIncrement:i.auto});return n.forEach(t=>e3(s,t)),s}function e3(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function e5(t,e,i){let n={};return w(e.objectStoreNames,0).forEach(t=>{let e=i.objectStore(t),s=e.keyPath,r=eW(eL(s),s||"",!1,!1,!!e.autoIncrement,s&&"string"!=typeof s,!0),o=[];for(let t=0;t<e.indexNames.length;++t){let i=e.index(e.indexNames[t]);s=i.keyPath;var a=eW(i.name,s,!!i.unique,!!i.multiEntry,!1,s&&"string"!=typeof s,!1);o.push(a)}n[t]=eH(t,r,o)}),n}function e8({_novip:t},e,i){let n=i.db.objectStoreNames;for(let s=0;s<n.length;++s){let r=n[s],o=i.objectStore(r);t._hasGetAll="getAll"in o;for(let t=0;t<o.indexNames.length;++t){let i=o.indexNames[t],n=o.index(i).keyPath,s="string"==typeof n?n:"["+w(n).join("+")+"]";if(e[r]){let t=e[r].idxByName[s];t&&(t.name=i,delete e[r].idxByName[s],e[r].idxByName[i]=t)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class e6{_parseStoresSpec(t,e){r(t).forEach(i=>{if(null!==t[i]){var n=t[i].split(",").map((t,e)=>{let i=(t=t.trim()).replace(/([&*]|\+\+)/g,""),n=/^\[/.test(i)?i.match(/^\[(.*)\]$/)[1].split("+"):i;return eW(i,n||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),o(n),0===e)}),s=n.shift();if(s.multi)throw new Q.Schema("Primary key cannot be multi-valued");n.forEach(t=>{if(t.auto)throw new Q.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new Q.Schema("Index must have a name and cannot be an empty string")}),e[i]=eH(i,s,n)}})}stores(t){let e=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,t):t;let i=e._versions,n={},s={};return i.forEach(t=>{a(n,t._cfg.storesSource),s=t._cfg.dbschema={},t._parseStoresSpec(n,s)}),e._dbSchema=s,e1(e,[e._allTables,e,e.Transaction.prototype]),eZ(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],r(s),s),e._storeNames=r(s),this}upgrade(t){return this._cfg.contentUpgrade=tc(this._cfg.contentUpgrade||te,t),this}}function e9(t,e){let i=t._dbNamesDB;return i||(i=t._dbNamesDB=new ig(ec,{addons:[],indexedDB:t,IDBKeyRange:e})).version(1).stores({dbnames:"name"}),i.table("dbnames")}function e7(t){return t&&"function"==typeof t.databases}function it(t){return tX(function(){return tS.letThrough=!0,t()})}function ie(t){var e=e=>t.next(e),i=s(e),n=s(e=>t.throw(e));function s(t){return e=>{var s=t(e),r=s.value;return s.done?r:r&&"function"==typeof r.then?r.then(i,n):o(r)?Promise.all(r).then(i,n):i(r)}}return s(e)()}function ii(t,e,i){var n=arguments.length;if(n<2)throw new Q.InvalidArgument("Too few arguments");for(var s=Array(n-1);--n;)s[n-1]=arguments[n];return i=s.pop(),[t,S(s),i]}function is(t,e,i){let n=o(t)?t.slice():[t];for(let t=0;t<i;++t)n.push(e);return n}let ir={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){let i=t.table(e),{schema:n}=i,s={},r=[];function o(t,e,i){let n=eX(t),a=s[n]=s[n]||[],l=null==t?0:"string"==typeof t?1:t.length,c=e>0,h={...i,isVirtual:c,keyTail:e,keyLength:l,extractKey:eG(t),unique:!c&&i.unique};return a.push(h),h.isPrimaryKey||r.push(h),l>1&&o(2===l?t[0]:t.slice(0,l-1),e+1,i),a.sort((t,e)=>t.keyTail-e.keyTail),h}let a=o(n.primaryKey.keyPath,0,n.primaryKey);for(let t of(s[":id"]=[a],n.indexes))o(t.keyPath,0,t);function l(e){var i,n;let s=e.query.index;return s.isVirtual?{...e,query:{index:s,range:(i=e.query.range,n=s.keyTail,{type:1===i.type?2:i.type,lower:is(i.lower,i.lowerOpen?t.MAX_KEY:t.MIN_KEY,n),lowerOpen:!0,upper:is(i.upper,i.upperOpen?t.MIN_KEY:t.MAX_KEY,n),upperOpen:!0})}}:e}return{...i,schema:{...n,primaryKey:a,indexes:r,getIndexByKeyPath:function(t){let e=s[eX(t)];return e&&e[0]}},count:t=>i.count(l(t)),query:t=>i.query(l(t)),openCursor(e){let{keyTail:n,isVirtual:s,keyLength:r}=e.query.index;return s?i.openCursor(l(e)).then(i=>i&&Object.create(i,{continue:{value:function(s){null!=s?i.continue(is(s,e.reverse?t.MAX_KEY:t.MIN_KEY,n)):e.unique?i.continue(i.key.slice(0,r).concat(e.reverse?t.MIN_KEY:t.MAX_KEY,n)):i.continue()}},continuePrimaryKey:{value(e,s){i.continuePrimaryKey(is(e,t.MAX_KEY,n),s)}},primaryKey:{get:()=>i.primaryKey},key:{get(){let t=i.key;return 1===r?t[0]:t.slice(0,r)}},value:{get:()=>i.value}})):i.openCursor(e)}}}}}};function io(t,e,i,n){return i=i||{},n=n||"",r(t).forEach(s=>{if(h(e,s)){var r=t[s],o=e[s];if("object"==typeof r&&"object"==typeof o&&r&&o){let t=K(r);t!==K(o)?i[n+s]=e[s]:"Object"===t?io(r,o,i,n+s+"."):r!==o&&(i[n+s]=e[s])}else r!==o&&(i[n+s]=e[s])}else i[n+s]=void 0}),r(e).forEach(s=>{h(t,s)||(i[n+s]=e[s])}),i}let ia={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){let i=t.table(e),{primaryKey:n}=i.schema;return{...i,mutate(t){let s=tS.trans,{deleting:r,creating:o,updating:a}=s.table(e).hook;switch(t.type){case"add":if(o.fire===te)break;return s._promise("readwrite",()=>l(t),!0);case"put":if(o.fire===te&&a.fire===te)break;return s._promise("readwrite",()=>l(t),!0);case"delete":if(r.fire===te)break;return s._promise("readwrite",()=>l(t),!0);case"deleteRange":if(r.fire===te)break;return s._promise("readwrite",()=>(function t(e,s,r){return i.query({trans:e,values:!1,query:{index:n,range:s},limit:r}).then(({result:i})=>l({type:"delete",keys:i,trans:e}).then(n=>n.numFailures>0?Promise.reject(n.failures[0]):i.length<r?{failures:[],numFailures:0,lastResult:void 0}:t(e,{...s,lower:i[i.length-1],lowerOpen:!0},r)))})(t.trans,t.range,1e4),!0)}return i.mutate(t);function l(t){var e,s;let l=tS.trans,c=t.keys||("delete"===(e=t).type?e.keys:e.keys||e.values.map(n.extractKey));if(!c)throw Error("Keys missing");return"delete"!==(t="add"===t.type||"put"===t.type?{...t,keys:c}:{...t}).type&&(t.values=[...t.values]),t.keys&&(t.keys=[...t.keys]),("add"===(s=t).type?Promise.resolve([]):i.getMany({trans:s.trans,keys:c,cache:"immutable"})).then(e=>{let s=c.map((i,s)=>{let c=e[s],u={onerror:null,onsuccess:null};if("delete"===t.type)r.fire.call(u,i,c,l);else if("add"===t.type||void 0===c){let e=o.fire.call(u,i,t.values[s],l);null==i&&null!=e&&(i=e,t.keys[s]=i,n.outbound||k(t.values[s],n.keyPath,i))}else{let e=io(c,t.values[s]),n=a.fire.call(u,e,i,c,l);if(n){let e=t.values[s];Object.keys(n).forEach(t=>{h(e,t)?e[t]=n[t]:k(e,t,n[t])})}}return u});return i.mutate(t).then(({failures:i,results:n,numFailures:r,lastResult:o})=>{for(let r=0;r<c.length;++r){let o=n?n[r]:c[r],a=s[r];null==o?a.onerror&&a.onerror(i[r]):a.onsuccess&&a.onsuccess("put"===t.type&&e[r]?t.values[r]:o)}return{failures:i,results:n,numFailures:r,lastResult:o}}).catch(t=>(s.forEach(e=>e.onerror&&e.onerror(t)),Promise.reject(t)))})}}}}})};function il(t,e,i){try{if(!e||e.keys.length<t.length)return null;let n=[];for(let s=0,r=0;s<e.keys.length&&r<t.length;++s)0===eE(e.keys[s],t[r])&&(n.push(i?C(e.values[s]):e.values[s]),++r);return n.length===t.length?n:null}catch(t){return null}}let ic={stack:"dbcore",level:-1,create:t=>({table:e=>{let i=t.table(e);return{...i,getMany:t=>{if(!t.cache)return i.getMany(t);let e=il(t.keys,t.trans._cache,"clone"===t.cache);return e?tC.resolve(e):i.getMany(t).then(e=>(t.trans._cache={keys:t.keys,values:"clone"===t.cache?C(e):e},e))},mutate:t=>("add"!==t.type&&(t.trans._cache=null),i.mutate(t))}}})};function ih(t){return!("from"in t)}let iu=function(t,e){if(!this){let e=new iu;return t&&"d"in t&&a(e,t),e}a(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function ip(t,e,i){let n=eE(e,i);if(isNaN(n))return;if(n>0)throw RangeError();if(ih(t))return a(t,{from:e,to:i,d:1});let s=t.l,r=t.r;if(0>eE(i,t.from))return s?ip(s,e,i):t.l={from:e,to:i,d:1,l:null,r:null},i_(t);if(eE(e,t.to)>0)return r?ip(r,e,i):t.r={from:e,to:i,d:1,l:null,r:null},i_(t);0>eE(e,t.from)&&(t.from=e,t.l=null,t.d=r?r.d+1:1),eE(i,t.to)>0&&(t.to=i,t.r=null,t.d=t.l?t.l.d+1:1);let o=!t.r;s&&!t.l&&id(t,s),r&&o&&id(t,r)}function id(t,e){ih(e)||function t(e,{from:i,to:n,l:s,r:r}){ip(e,i,n),s&&t(e,s),r&&t(e,r)}(t,e)}function im(t){let e=ih(t)?null:{s:0,n:t};return{next(t){let i=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,i)for(;e.n.l&&0>eE(t,e.n.from);)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!i||0>=eE(t,e.n.to))return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function i_(t){var e,i;let n=((null===(e=t.r)||void 0===e?void 0:e.d)||0)-((null===(i=t.l)||void 0===i?void 0:i.d)||0),s=n>1?"r":n<-1?"l":"";if(s){let e="r"===s?"l":"r",i={...t},n=t[s];t.from=n.from,t.to=n.to,t[s]=n[s],i[s]=n[e],t[e]=i,i.d=iy(i)}t.d=iy(t)}function iy({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}u(iu.prototype,{add(t){return id(this,t),this},addKey(t){return ip(this,t,t),this},addKeys(t){return t.forEach(t=>ip(this,t,t)),this},[j](){return im(this)}});let iw={stack:"dbcore",level:0,create:t=>{let e=t.schema.name,i=new iu(t.MIN_KEY,t.MAX_KEY);return{...t,table:n=>{let s=t.table(n),{schema:a}=s,{primaryKey:l}=a,{extractKey:c,outbound:h}=l,u={...s,mutate:t=>{let r=t.trans,l=r.mutatedParts||(r.mutatedParts={}),c=t=>{let i=`idb://${e}/${n}/${t}`;return l[i]||(l[i]=new iu)},h=c(""),u=c(":dels"),{type:p}=t,[d,m]="deleteRange"===t.type?[t.range]:"delete"===t.type?[t.keys]:t.values.length<50?[[],t.values]:[],_=t.trans._cache;return s.mutate(t).then(t=>{if(o(d)){"delete"!==p&&(d=t.results),h.addKeys(d);let e=il(d,_);e||"add"===p||u.addKeys(d),(e||m)&&function(t,e,i,n){e.indexes.forEach(function(e){let s=t(e.name||"");function r(t){return null!=t?e.extractKey(t):null}let a=t=>e.multiEntry&&o(t)?t.forEach(t=>s.addKey(t)):s.addKey(t);(i||n).forEach((t,e)=>{let s=i&&r(i[e]),o=n&&r(n[e]);0!==eE(s,o)&&(null!=s&&a(s),null!=o&&a(o))})})}(c,a,e,m)}else if(d){let t={from:d.lower,to:d.upper};u.add(t),h.add(t)}else h.add(i),u.add(i),a.indexes.forEach(t=>c(t.name).add(i));return t})}},p=({query:{index:e,range:i}})=>{var n,s;return[e,new iu(null!==(n=i.lower)&&void 0!==n?n:t.MIN_KEY,null!==(s=i.upper)&&void 0!==s?s:t.MAX_KEY)]},d={get:t=>[l,new iu(t.key)],getMany:t=>[l,(new iu).addKeys(t.keys)],count:p,query:p,openCursor:p};return r(d).forEach(t=>{u[t]=function(r){let{subscr:o}=tS;if(o){let a=t=>{let i=`idb://${e}/${n}/${t}`;return o[i]||(o[i]=new iu)},l=a(""),u=a(":dels"),[p,m]=d[t](r);if(a(p.name||"").add(m),!p.isPrimaryKey){if("count"!==t){let e="query"===t&&h&&r.values&&s.query({...r,values:!1});return s[t].apply(this,arguments).then(i=>{if("query"===t){if(h&&r.values)return e.then(({result:t})=>(l.addKeys(t),i));let t=r.values?i.result.map(c):i.result;r.values?l.addKeys(t):u.addKeys(t)}else if("openCursor"===t){let t=r.values;return i&&Object.create(i,{key:{get:()=>(u.addKey(i.primaryKey),i.key)},primaryKey:{get(){let t=i.primaryKey;return u.addKey(t),t}},value:{get:()=>(t&&l.addKey(i.primaryKey),i.value)}})}return i})}u.add(i)}}return s[t].apply(this,arguments)}}),u}}}};class ig{constructor(t,e){var i,n,s,r,o;this._middlewares={},this.verno=0;let a=ig.dependencies;this._options=e={addons:ig.addons,autoOpen:!0,indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange,...e},this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange};let{addons:l}=e;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let c={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:te,dbReadyPromise:null,cancelOpen:te,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};c.dbReadyPromise=new tC(t=>{c.dbReadyResolve=t}),c.openCanceller=new tC((t,e)=>{c.cancelOpen=e}),this._state=c,this.name=t,this.on=ef(this,"populate","blocked","versionchange","close",{ready:[tc,te]}),this.on.ready.subscribe=g(this.on.ready.subscribe,t=>(e,i)=>{ig.vip(()=>{let n=this._state;if(n.openComplete)n.dbOpenError||tC.resolve().then(e),i&&t(e);else if(n.onReadyBeingFired)n.onReadyBeingFired.push(e),i&&t(e);else{t(e);let n=this;i||t(function t(){n.on.ready.unsubscribe(e),n.on.ready.unsubscribe(t)})}})}),this.Collection=(i=this,ey(eP.prototype,function(t,e){this.db=i;let n=ed,s=null;if(e)try{n=e()}catch(t){s=t}let r=t._ctx,o=r.table,a=o.hook.reading.fire;this._ctx={table:o,index:r.index,isPrimKey:!r.index||o.schema.primKey.keyPath&&r.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:s,or:r.or,valueMapper:a!==ti?a:null}})),this.Table=(n=this,ey(e_.prototype,function(t,e,i){this.db=n,this._tx=i,this.name=t,this.schema=e,this.hook=n._allTables[t]?n._allTables[t].hook:ef(null,{creating:[tr,te],reading:[tn,ti],updating:[ta,te],deleting:[to,te]})})),this.Transaction=(s=this,ey(e$.prototype,function(t,e,i,n,r){this.db=s,this.mode=t,this.storeNames=e,this.schema=i,this.chromeTransactionDurability=n,this.idbtrans=null,this.on=ef(this,"complete","error","abort"),this.parent=r||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new tC((t,e)=>{this._resolve=t,this._reject=e}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},t=>{var e=this.active;return this.active=!1,this.on.error.fire(t),this.parent?this.parent._reject(t):e&&this.idbtrans&&this.idbtrans.abort(),et(t)})})),this.Version=(r=this,ey(e6.prototype,function(t){this.db=r,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(o=this,ey(eN.prototype,function(t,e,i){this.db=o,this._ctx={table:t,index:":id"===e?null:e,or:i};let n=o._deps.indexedDB;if(!n)throw new Q.MissingAPI;this._cmp=this._ascending=n.cmp.bind(n),this._descending=(t,e)=>n.cmp(e,t),this._max=(t,e)=>n.cmp(t,e)>0?t:e,this._min=(t,e)=>0>n.cmp(t,e)?t:e,this._IDBKeyRange=o._deps.IDBKeyRange})),this.on("versionchange",t=>{t.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",t=>{!t.newVersion||t.newVersion<t.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${t.oldVersion/10}`)}),this._maxKey=eV(e.IDBKeyRange),this._createTransaction=(t,e,i,n)=>new this.Transaction(t,e,i,this._options.chromeTransactionDurability,n),this._fireOnBlocked=t=>{this.on("blocked").fire(t),eo.filter(t=>t.name===this.name&&t!==this&&!t._state.vcFired).map(e=>e.on("versionchange").fire(t))},this.use(ir),this.use(ia),this.use(iw),this.use(ic),this.vip=Object.create(this,{_vip:{value:!0}}),l.forEach(t=>t(this))}version(t){if(isNaN(t)||t<.1)throw new Q.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new Q.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);let e=this._versions;var i=e.filter(e=>e._cfg.version===t)[0];return i||(i=new this.Version(t),e.push(i),e.sort(e0),i.stores({}),this._state.autoSchema=!1,i)}_whenReady(t){return this.idbdb&&(this._state.openComplete||tS.letThrough||this._vip)?t():new tC((t,e)=>{if(this._state.openComplete)return e(new Q.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void e(new Q.DatabaseClosed);this.open().catch(te)}this._state.dbReadyPromise.then(t,e)}).then(t)}use({stack:t,create:e,level:i,name:n}){n&&this.unuse({stack:t,name:n});let s=this._middlewares[t]||(this._middlewares[t]=[]);return s.push({stack:t,create:e,level:null==i?10:i,name:n}),s.sort((t,e)=>t.level-e.level),this}unuse({stack:t,name:e,create:i}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(t=>i?t.create!==i:!!e&&t.name!==e)),this}open(){return function(t){var e;let i=t._state,{indexedDB:n}=t._deps;if(i.isBeingOpened||t.idbdb)return i.dbReadyPromise.then(()=>i.dbOpenError?et(i.dbOpenError):t);z&&(i.openCanceller._stackHolder=U()),i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;let s=i.openCanceller;function o(){if(i.openCanceller!==s)throw new Q.DatabaseClosed("db.open() was cancelled")}let a=i.dbReadyResolve,l=null,c=!1;return tC.race([s,("undefined"==typeof navigator?tC.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var i=function(){return indexedDB.databases().finally(t)};e=setInterval(i,100),i()}).finally(function(){return clearInterval(e)}):Promise.resolve()).then(()=>new tC((e,s)=>{if(o(),!n)throw new Q.MissingAPI;let a=t.name,h=i.autoSchema?n.open(a):n.open(a,Math.round(10*t.verno));if(!h)throw new Q.MissingAPI;h.onerror=eM(s),h.onblocked=tW(t._fireOnBlocked),h.onupgradeneeded=tW(e=>{if(l=h.transaction,i.autoSchema&&!t._options.allowEmptyDB){h.onerror=ez,l.abort(),h.result.close();let t=n.deleteDatabase(a);t.onsuccess=t.onerror=tW(()=>{s(new Q.NoSuchDatabase(`Database ${a} doesnt exist`))})}else{l.onerror=eM(s);var o=e.oldVersion>0x4000000000000000?0:e.oldVersion;c=o<1,t._novip.idbdb=h.result,function(t,e,i,n){let s=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,s);o.create(i),o._completion.catch(n);let a=o._reject.bind(o),l=tS.transless||tS;tX(()=>{tS.trans=o,tS.transless=l,0===e?(r(s).forEach(t=>{e4(i,t,s[t].primKey,s[t].indexes)}),eQ(t,i),tC.follow(()=>t.on.populate.fire(o)).catch(a)):(function({_novip:t},e,i,n){let s=[],o=t._versions,a=t._dbSchema=e5(t,t.idbdb,n),l=!1;return o.filter(t=>t._cfg.version>=e).forEach(o=>{s.push(()=>{let s=a,c=o._cfg.dbschema;e8(t,s,n),e8(t,c,n),a=t._dbSchema=c;let h=e2(s,c);h.add.forEach(t=>{e4(n,t[0],t[1].primKey,t[1].indexes)}),h.change.forEach(t=>{if(t.recreate)throw new Q.Upgrade("Not yet support for changing primary key");{let e=n.objectStore(t.name);t.add.forEach(t=>e3(e,t)),t.change.forEach(t=>{e.deleteIndex(t.name),e3(e,t)}),t.del.forEach(t=>e.deleteIndex(t))}});let u=o._cfg.contentUpgrade;if(u&&o._cfg.version>e){let e;eQ(t,n),i._memoizedTables={},l=!0;let o=E(c);h.del.forEach(t=>{o[t]=s[t]}),e1(t,[t.Transaction.prototype]),eZ(t,[t.Transaction.prototype],r(o),o),i.schema=o;let a=M(u);a&&tQ();let p=tC.follow(()=>{if((e=u(i))&&a){var t=tZ.bind(null,null);e.then(t,t)}});return e&&"function"==typeof e.then?tC.resolve(e):p.then(()=>e)}}),s.push(e=>{l&&ea||function(t,e){[].slice.call(e.db.objectStoreNames).forEach(i=>null==t[i]&&e.db.deleteObjectStore(i))}(o._cfg.dbschema,e),e1(t,[t.Transaction.prototype]),eZ(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),i.schema=t._dbSchema})}),(function t(){return s.length?tC.resolve(s.shift()(i.idbtrans)).then(t):tC.resolve()})().then(()=>{var t;r(t=a).forEach(e=>{n.db.objectStoreNames.contains(e)||e4(n,e,t[e].primKey,t[e].indexes)})})})(t,e,o,i).catch(a)})}(t,o/10,l,s)}},s),h.onsuccess=tW(()=>{l=null;let n=t._novip.idbdb=h.result,s=w(n.objectStoreNames);if(s.length>0)try{let e=n.transaction(1===s.length?s[0]:s,"readonly");i.autoSchema?function({_novip:t},e,i){t.verno=e.version/10;let n=t._dbSchema=e5(0,e,i);t._storeNames=w(e.objectStoreNames,0),eZ(t,[t._allTables],r(n),n)}(t,n,e):(e8(t,t._dbSchema,e),function(t,e){let i=e2(e5(0,t.idbdb,e),t._dbSchema);return!(i.add.length||i.change.some(t=>t.add.length||t.change.length))}(t,e)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),eQ(t,e)}catch(t){}eo.push(t),n.onversionchange=tW(e=>{i.vcFired=!0,t.on("versionchange").fire(e)}),n.onclose=tW(e=>{t.on("close").fire(e)}),c&&function({indexedDB:t,IDBKeyRange:e},i){e7(t)||i===ec||e9(t,e).put({name:i}).catch(te)}(t._deps,a),e()},s)}))]).then(()=>(o(),i.onReadyBeingFired=[],tC.resolve(it(()=>t.on.ready.fire(t.vip))).then(function e(){if(i.onReadyBeingFired.length>0){let n=i.onReadyBeingFired.reduce(tc,te);return i.onReadyBeingFired=[],tC.resolve(it(()=>n(t.vip))).then(e)}}))).finally(()=>{i.onReadyBeingFired=null,i.isBeingOpened=!1}).then(()=>t).catch(e=>{i.dbOpenError=e;try{l&&l.abort()}catch(t){}return s===i.openCanceller&&t._close(),et(e)}).finally(()=>{i.openComplete=!0,a()})}(this)}_close(){let t=this._state,e=eo.indexOf(this);if(e>=0&&eo.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(t){}this._novip.idbdb=null}t.dbReadyPromise=new tC(e=>{t.dbReadyResolve=e}),t.openCanceller=new tC((e,i)=>{t.cancelOpen=i})}close(){this._close();let t=this._state;this._options.autoOpen=!1,t.dbOpenError=new Q.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){let t=arguments.length>0,e=this._state;return new tC((i,n)=>{let s=()=>{this.close();var t=this._deps.indexedDB.deleteDatabase(this.name);t.onsuccess=tW(()=>{(function({indexedDB:t,IDBKeyRange:e},i){e7(t)||i===ec||e9(t,e).delete(i).catch(te)})(this._deps,this.name),i()}),t.onerror=eM(n),t.onblocked=this._fireOnBlocked};if(t)throw new Q.InvalidArgument("Arguments not allowed in db.delete()");e.isBeingOpened?e.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){let t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return r(this._allTables).map(t=>this._allTables[t])}transaction(){let t=ii.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,e,i){let n,s,r=tS.trans;r&&r.db===this&&-1===t.indexOf("!")||(r=null);let o=-1!==t.indexOf("?");t=t.replace("!","").replace("?","");try{if(s=e.map(t=>{var e=t instanceof this.Table?t.name:t;if("string"!=typeof e)throw TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e}),"r"==t||t===eh)n=eh;else{if("rw"!=t&&t!=eu)throw new Q.InvalidArgument("Invalid transaction mode: "+t);n=eu}if(r){if(r.mode===eh&&n===eu){if(!o)throw new Q.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&s.forEach(t=>{if(r&&-1===r.storeNames.indexOf(t)){if(!o)throw new Q.SubTransaction("Table "+t+" not included in parent transaction.");r=null}}),o&&r&&!r.active&&(r=null)}}catch(t){return r?r._promise(null,(e,i)=>{i(t)}):et(t)}let a=(function t(e,i,n,s,r){return tC.resolve().then(()=>{let o;let a=tS.transless||tS,l=e._createTransaction(i,n,e._dbSchema,s);if(s)l.idbtrans=s.idbtrans;else try{l.create(),e._state.PR1398_maxLoop=3}catch(s){return s.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>t(e,i,n,null,r))):et(s)}let c=M(r);c&&tQ();let h=tC.follow(()=>{if(o=r.call(l,l)){if(c){var t=tZ.bind(null,null);o.then(t,t)}else"function"==typeof o.next&&"function"==typeof o.throw&&(o=ie(o))}},{trans:l,transless:a});return(o&&"function"==typeof o.then?tC.resolve(o).then(t=>l.active?t:et(new Q.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):h.then(()=>o)).then(t=>(s&&l._resolve(),l._completion.then(()=>t))).catch(t=>(l._reject(t),et(t)))})}).bind(null,this,n,s,r,i);return r?r._promise(n,a,"lock"):tS.trans?t5(tS.transless,()=>this._whenReady(a)):this._whenReady(a)}table(t){if(!h(this._allTables,t))throw new Q.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}let ib="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class iv{constructor(t){this._subscribe=t}subscribe(t,e,i){return this._subscribe(t&&"function"!=typeof t?t:{next:t,error:e,complete:i})}[ib](){return this}}function ix(t,e){return r(e).forEach(i=>{id(t[i]||(t[i]=new iu),e[i])}),t}try{n={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch(t){n={indexedDB:null,IDBKeyRange:null}}function iO(t){let e=ik;try{ik=!0,eU.storagemutated.fire(t)}finally{ik=e}}u(ig,{...tt,delete:t=>new ig(t,{addons:[]}).delete(),exists:t=>new ig(t,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return(function({indexedDB:t,IDBKeyRange:e}){return e7(t)?Promise.resolve(t.databases()).then(t=>t.map(t=>t.name).filter(t=>t!==ec)):e9(t,e).toCollection().primaryKeys()})(ig.dependencies).then(t)}catch(t){return et(new Q.MissingAPI)}},defineClass:()=>function(t){a(this,t)},ignoreTransaction:t=>tS.trans?t5(tS.transless,t):t(),vip:it,async:function(t){return function(){try{var e=ie(t.apply(this,arguments));return e&&"function"==typeof e.then?e:tC.resolve(e)}catch(t){return et(t)}}},spawn:function(t,e,i){try{var n=ie(t.apply(i,e||[]));return n&&"function"==typeof n.then?n:tC.resolve(n)}catch(t){return et(t)}},currentTransaction:{get:()=>tS.trans||null},waitFor:function(t,e){let i=tC.resolve("function"==typeof t?ig.ignoreTransaction(t):t).timeout(e||6e4);return tS.trans?tS.trans.waitFor(i):i},Promise:tC,debug:{get:()=>z,set:t=>{z=t,q="dexie"===t?()=>!0:el}},derive:m,extend:a,props:u,override:g,Events:ef,on:eU,liveQuery:function(t){let e,i=!1,n=new iv(n=>{let s=M(t),o=!1,a={},l={},c={get closed(){return o},unsubscribe:()=>{o=!0,eU.storagemutated.unsubscribe(d)}};n.start&&n.start(c);let h=!1,u=!1;function p(){return r(l).some(t=>a[t]&&function(t,e){let i=im(e),n=i.next();if(n.done)return!1;let s=n.value,r=im(t),o=r.next(s.from),a=o.value;for(;!n.done&&!o.done;){if(0>=eE(a.from,s.to)&&eE(a.to,s.from)>=0)return!0;0>eE(s.from,a.from)?s=(n=i.next(a.from)).value:a=(o=r.next(s.from)).value}return!1}(a[t],l[t]))}let d=t=>{ix(a,t),p()&&m()},m=()=>{if(h||o)return;a={};let r={},_=function(e){s&&tQ();let i=()=>tX(t,{subscr:e,trans:null}),n=tS.trans?t5(tS.transless,i):i();return s&&n.then(tZ,tZ),n}(r);u||(eU(eq,d),u=!0),h=!0,Promise.resolve(_).then(t=>{i=!0,e=t,h=!1,o||(p()?m():(a={},l=r,n.next&&n.next(t)))},t=>{h=!1,i=!1,n.error&&n.error(t),c.unsubscribe()})};return m(),c});return n.hasValue=()=>i,n.getValue=()=>e,n},extendObservabilitySet:ix,getByKeyPath:O,setByKeyPath:k,delByKeyPath:function(t,e){"string"==typeof e?k(t,e,void 0):"length"in e&&[].map.call(e,function(e){k(t,e,void 0)})},shallowClone:E,deepClone:C,getObjectDiff:io,cmp:eE,asap:v,minKey:en,addons:[],connections:eo,errnames:X,dependencies:n,semVer:ee,version:ee.split(".").map(t=>parseInt(t)).reduce((t,e,i)=>t+e/Math.pow(10,2*i))}),ig.maxKey=eV(ig.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(eU(eq,t=>{if(!ik){let e;ea?(e=document.createEvent("CustomEvent")).initCustomEvent(eF,!0,!0,t):e=new CustomEvent(eF,{detail:t}),ik=!0,dispatchEvent(e),ik=!1}}),addEventListener(eF,({detail:t})=>{ik||iO(t)}));let ik=!1;if("undefined"!=typeof BroadcastChannel){let t=new BroadcastChannel(eF);"function"==typeof t.unref&&t.unref(),eU(eq,e=>{ik||t.postMessage(e)}),t.onmessage=t=>{t.data&&iO(t.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){eU(eq,t=>{try{ik||("undefined"!=typeof localStorage&&localStorage.setItem(eF,JSON.stringify({trig:Math.random(),changedParts:t})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(e=>e.postMessage({type:eF,changedParts:t})))}catch(t){}}),"undefined"!=typeof addEventListener&&addEventListener("storage",t=>{if(t.key===eF){let e=JSON.parse(t.newValue);e&&iO(e.changedParts)}});let t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:t}){t&&t.type===eF&&iO(t.changedParts)})}tC.rejectionMapper=function(t,e){if(!t||t instanceof V||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Z[t.name])return t;var i=new Z[t.name](e||t.message,t);return"stack"in t&&d(i,"stack",{get:function(){return this.inner.stack}}),i},q=el}}]);